var Table2Game=function(e,t){function i(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(0===t.y)return!1;if(this.collidingFromBelow(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromBelow(t,e[o]))return!1;return!0}function o(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(t.y===this.screenHeight-1)return!1;if(this.collidingFromAbove(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromAbove(t,e[o]))return!1;return!0}function s(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(0===t.x)return!1;if(this.collidingFromRight(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromRight(t,e[o]))return!1;return!0}function r(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(t.x===this.screenWidth-1)return!1;if(this.collidingFromLeft(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromLeft(t,e[o]))return!1;return!0}function l(e,t){var i=Object.keys(t.getSprites(/playerBullet/)||{}).length;this.x=e.x,this.y=e.y,this.velocityX=e.velocityX,this.velocityY=e.velocityY,this.width=e.width||1,this.height=e.height||1,this.name=e.name||"playerBullet"+i,t.registerSprites(this.name,{x:e.x,y:e.y,velocityX:e.velocityX,velocityY:e.velocityY,width:e.width||1,height:e.height||1});var o=this;this.moveY=function(){if(o.y>=0&&o.velocityY<0){var e=t.getSprites(o.name)||{};o.y+=o.velocityY,e.y=o.y,setTimeout(o.moveY,t.delay)}else t.unregisterSprite(o.name)}}function n(e){switch(c.call(this),e.y){case 0:switch(e.x){case 0:a.call(this,"bottom","right"),this.registerSprites("enemy0",{x:1,y:1,color:Ce});break;case 1:a.call(this,"bottom","left","right");for(var t=this.getGlobals("hasKey"),i=this.screenWidth-(t?3:2),o=1;i>=o;o++)this.registerSprites("enemy"+o,{x:o,y:this.screenHeight-3,width:1,height:1,color:Ce});t||this.registerSprites("key",{x:1,y:this.screenHeight-2,color:this.yellow});break;case 2:a.call(this,"bottom","left","right");var s=this.getGlobals("doorCoords");this.registerSprites("topDoor",{x:s.top.x,y:s.top.y,width:1,height:1,color:this.defaultColor});for(var o=1;o<=this.screenWidth-2;o++)this.registerSprites("enemy"+o,{x:o,y:2,width:1,height:1,color:Ce});break;case 3:a.call(this,"bottom","left");break;case 4:a.call(this,"bottom","top"),this.registerSprites("block",{x:1,y:2,width:this.screenWidth-2,color:We}),this.registerSprites("keyhole",{x:Math.floor(this.screenWidth/2),y:2,color:this.yellow}),this.registerSprites("gameWinningDoor",{x:Math.floor(this.screenWidth/2),y:0,color:this.green}),this.registerSprites("enemy0",{x:1,y:1,width:Math.floor(this.screenWidth/2)-2,color:Ce}),this.registerSprites("enemy1",{x:Math.floor(gt.screenWidth/2)+2,y:1,width:gt.screenWidth-Math.floor(gt.screenWidth/2)-3,color:Ce})}break;case 1:switch(e.x){case 0:a.call(this,"top","bottom"),this.registerSprites("enemy0",{x:2,y:2,color:Ce}).registerSprites("enemy1",{x:this.screenWidth-3,y:this.screenHeight-3,color:Ce});break;case 1:a.call(this,"top","right"),this.registerSprites("enemy0",{polygon:[{x:this.screenWidth-2,y:this.screenHeight-2,width:1,height:1,color:Ce}]});break;case 2:a.call(this,"top","left"),this.registerSprites("enemy0",{x:2,y:2,color:Ce}).registerSprites("enemy1",{x:2,y:2,color:Ce});break;case 3:a.call(this,"top","bottom"),this.registerSprites("enemy0",{x:this.screenWidth-2,y:2,color:Ce}).registerSprites("enemy1",{x:1,y:this.screenHeight-3,color:Ce});break;case 4:a.call(this,"top","bottom");var r=this.getSprites("player");if(1===r.y){this.registerSprites("enemy0",{velocityX:-1,x:-1,y:-1,polygon:[{x:this.screenWidth-2,y:this.screenHeight-2,width:1,height:1,color:Ce}]});var l=this.getSprites("enemy0"),n=Math.floor((this.screenWidth-2)/2);this.setGlobals("roomTimeCount",(this.screenWidth-2)*(this.screenHeight-2));for(var o=2;n>=o;o++)l.polygon.push({x:this.screenWidth-o,y:this.screenHeight-2,width:1,height:1,color:Ce});l.polygon.reverse()}else{this.registerSprites("enemy0",{velocityX:1,x:-1,y:-1,polygon:[{x:1,y:1,width:1,height:1,color:Ce}]});for(var l=this.getSprites("enemy0"),n=Math.floor((this.screenWidth-2)/2),o=2;n>=o;o++)l.polygon.push({x:o,y:1,width:1,height:1,color:Ce});l.polygon.reverse()}}break;case 2:switch(e.x){case 0:a.call(this,"bottom","top","right");for(var h=Math.min(this.screenWidth,this.screenHeight)-2,y=h;h>1;)this.registerSprites("enemy"+h,{x:this.screenWidth-2-y+h,y:this.screenHeight-1-h,color:Ce}),h--;break;case 1:a.call(this,"bottom","left","right");for(var o=1;o<this.screenWidth-1;o++)this.registerSprites("enemy"+o,{x:o,y:1,color:Ce});break;case 2:a.call(this,"left","right"),this.registerSprites("enemy0",{x:2,y:2,width:this.screenWidth-4,height:this.screenHeight-4,color:Ce});break;case 3:a.call(this,"top","left"),this.registerSprites("enemy0",{x:1,y:2,width:1+Math.floor(this.screenWidth/2),color:Ce}).registerSprites("enemy1",{x:2+Math.floor(this.screenWidth/2),y:2,width:1,height:this.screenHeight-4,color:Ce}).registerSprites("enemy2",{x:2,y:this.screenHeight-3,width:Math.floor(this.screenWidth/2),color:Ce});break;case 4:a.call(this,"bottom","top");var p=2;for(this.registerSprites("enemy"+p,{x:Math.floor(this.screenWidth/2),y:p,color:Ce});p++<this.screenHeight-3;)this.registerSprites("enemy"+p,{x:Math.floor(this.screenWidth/2)-(p-2),y:p,color:Ce}).registerSprites("enemy"+p+"B",{x:Math.floor(this.screenWidth/2)+(p-2),y:p,color:Ce})}break;case 3:switch(e.x){case 0:a.call(this,"top","right"),this.registerSprites("enemy0",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),color:Ce});break;case 1:a.call(this,"top","left","right");break;case 2:a.call(this,"left","right"),this.registerSprites("enemy0",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),color:Ce});break;case 3:a.call(this,"left","right");for(var h=Math.min(this.screenWidth,this.screenHeight)-2,y=h;h>1;)this.registerSprites("enemy"+h,{x:1+y-h,y:h,color:Ce}),h--;break;case 4:a.call(this,"left","top"),this.registerSprites("enemy0",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),color:Ce})}break;default:4===e.x&&g.call(this)}var d=this.getGlobals("blockCoords");d.mapCoords.x===e.x&&d.mapCoords.y===e.y&&this.registerSprites("block",d.blockCoords),this.moveToTop("player")}function h(){var e=this.getSprites("player");this.flashEndingPosition=0,this.setGlobals("hasKey",!1),this.setGlobals("hasBlock",!1),this.setGlobals("gameOver",!1),this.setGlobals("roomTimeCount",0),this.setGlobals("roomCoords",{x:1,y:3}),this.setGlobals("blockCoords",{blockCoords:{x:Math.floor(this.screenWidth/2),y:3,color:We},mapCoords:{x:3,y:0}}),Me={top:0,bottom:0,left:0,right:0},e.x=Math.floor(this.screenWidth/2),e.y=Math.ceil(this.screenHeight/2),e.color=this.getGlobals("startingColor"),n.call(this,{x:1,y:3})}function a(){for(var e=this.getGlobals("doorCoords"),t=0,i=arguments.length;i>t;t++)this.registerSprites(arguments[t]+"Door",{x:e[arguments[t]].x,y:e[arguments[t]].y,width:1,height:1,color:ke})}function c(){var e=this.getSprites();for(var t in e)/Wall/i.test(t)||"player"===t||this.unregisterSprite(t)}function g(){var e=this,t=3,i=150;totalFlashTime=(2*t-1)*i,player=this.getSprites("player"),player.y=e.screenHeight-2,e.flashEnding(t),setTimeout(function(){e.unregisterSprite("leftWall")},totalFlashTime),setTimeout(function(){e.unregisterSprite("rightWall")},totalFlashTime+1e3),setTimeout(function(){e.unregisterSprite("topWall")},totalFlashTime+2e3),setTimeout(function(){e.unregisterSprite("bottomWall")},totalFlashTime+3e3),setTimeout(function(){e.registerSprites("sky",{x:0,y:0,width:e.screenWidth,height:e.screenHeight,color:e.blue}).registerSprites("grass",{x:0,y:e.screenHeight-1,width:e.screenWidth,height:1,color:e.green}).registerSprites("sun",{x:e.screenWidth-2,y:0,width:2,height:2,color:e.yellow}),e.setGlobals("gameOver",!0),player.x=Math.floor(e.screenWidth/2),player.y=e.screenHeight-2,e.moveToTop("player")},totalFlashTime+4e3)}Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=i.length;return function(s){if("function"!=typeof s&&("object"!=typeof s||null===s))throw new TypeError("Object.keys called on non-object");var r,l,n=[];for(r in s)e.call(s,r)&&n.push(r);if(t)for(l=0;o>l;l++)e.call(s,i[l])&&n.push(i[l]);return n}}());var y=t,p=t,d={"Ping Pong":{},Snake:{},"Break Bricks":{},"Whack-a-mole":{},Maze:{},"Creepy Crawler":{},Jumper:{},Paint:{},Sniper:{},Dungeon:{}},u=[],f={},m={},v=t,x=0,b=!1,S=function(){},w=50,k=function(){},C=function(){},W=!0,M=function(){},G=1,H=1,P=0,T=0,X="#ffffff",Y="#f1f1f1",D="#d1d1d1",E="#fff1f1",F="#f1fff1",B="#f1f1ff",L="#fffff1",O="#f1ffff",R="#fff1ff",A="#eee",I=null,N=null,j=null,_=null,J=null,K=null,q=null,z=null,V=null,Q=null,U=null,Z=null,$=null,ee=null,te=null,ie=null,oe=null,se={onkeydown:!1,onkeyup:!1,onkeypress:!1,onclick:!1,onmousedown:!1,onmouseup:!1,onmousemove:!1,onmouseenter:!1,onmouseleave:!1,onmouseover:!1,onmouseout:!1,onmousewheel:!1,oncontextmenu:!1,touchstart:!1,touchmove:!1,touchend:!1},re=!1,le=function(t,i,o,s){return e.attachEvent?t.attachEvent(i,o):t.addEventListener(i,o,s)},ne=function(t,i,o,s){return e.detachEvent?t.detachEvent(i,o):t.removeEventListener(i,o,s)},he=function(i,o){if(this===e)return new he(i);if(i=i||{},"string"==typeof i){if("undefined"!=typeof o){for(var s in o)d[i][s]=o[s];return new he(d[i],o)}return new he(d[i])}var r={table:document.querySelector?document.querySelector("table"):document.getElementsByTagName("table")[0],globals:{},sprites:{},details:{},delay:50,init:function(){},update:function(){},onpause:function(){},onunpause:function(){},onpaint:function(){}},l=[],n=1,h=1,a=null;y=t,p=t,u=[],m={},x=0,b=!1,runningTime=0,T=0,tableExists=!1,G=1,H=1,v&&clearInterval(v),i=i||{};for(var c in r)i[c]=i[c]||r[c];y=this,p="string"==typeof i.table?document.getElementById(i.table.replace("#","")):i.table.jquery?i.table[0]:i.table,y.table=p;for(var g in i.globals)y.registerGlobals(g,i.globals[g]);for(var f in i.sprites)y.registerSprites(f,i.sprites[f]);a=document.createElement("div"),a.id="Table2GameDetailsDiv",a.style.display="inline block",a.color="#eee",a.innerHTML="";for(var P in i.details)a.innerHTML+=P+": <span id='Table2Game"+P+"Span' class='Table2GameDetail' style='margin-right: 10px;'>"+i.details[P]+"</span>";a.style.marginLeft=y.table.style.marginLeft||(e.getComputedStyle?e.getComputedStyle(y.table).getPropertyValue("margin-left"):""),p.parentNode.insertBefore(a,p.nextSibling),y.detailsDiv=a,y.details=i.details,i.onkeydown?N?N=i.onkeydown:(N=i.onkeydown,le(e,"keydown",function(e){e.preventDefault(),N.call(y,e)},!1),se.onkeydown=!0):se.onkeydown&&(N=function(){},se.onkeydown=!1),i.onkeyup?j?j=i.onkeyup:(j=i.onkeyup,le(e,"keyup",function(e){e.preventDefault(),j.call(y,e)},!1),se.onkeyup=!0):se.onkeyup&&(j=function(){},se.onkeyup=!1),i.onkeypress?_?_=i.onkeypress:(_=i.onkeypress,le(e,"keypress",function(e){e.preventDefault(),_.call(y,e)},!1),se.onkeypress=!0):se.onkeypress&&(_=function(){},se.onkeypress=!1),i.onclick?(J?J=i.onclick:(J=i.onclick,le(y.table,"click",function(e){J.call(y,e)},!1),se.onclick=!0),p.style.cursor="default"):se.onclick&&(J=function(){},se.onclick=!1),i.onmousedown?(K?K=i.onmousedown:(K=i.onmousedown,le(y.table,"mousedown",function(e){K.call(y,e)},!1),se.onmousedown=!0),p.style.cursor="default"):se.onmousedown&&(K=function(){},se.onmousedown=!1),i.onmouseup?(q?q=i.onmouseup:(q=i.onmouseup,le(y.table,"mouseup",function(e){q.call(y,e)},!1),se.onmouseup=!0),p.style.cursor="default"):se.onmouseup&&(q=function(){},se.onmouseup=!1),i.onmousemove?(z?z=i.onmousemove:(z=i.onmousemove,le(y.table,"mousemove",function(e){z.call(y,e)},!1),se.onmousemove=!0),p.style.cursor="default"):se.onmousemove&&(z=function(){},se.onmousemove=!1),i.onmouseenter?(V?V=i.onmouseenter:(V=i.onmouseenter,le(y.table,"mouseenter",function(e){V.call(y,e)},!1),se.onmouseenter=!0),p.style.cursor="default"):se.onmouseenter&&(V=function(){},se.onmouseenter=!1),i.onmouseleave?(Q?Q=i.onmouseleave:(Q=i.onmouseleave,le(y.table,"mouseleave",function(e){Q.call(y,e)},!1),se.onmouseleave=!0),p.style.cursor="default"):se.onmouseleave&&(Q=function(){},se.onmouseleave=!1),i.onmouseover?(U?U=i.onmouseover:(U=i.onmouseover,le(y.table,"mouseover",function(e){U.call(y,e)},!1),se.onmouseover=!0),p.style.cursor="default"):se.onmouseover&&(U=function(){},se.onmouseover=!1),i.onmouseout?(Z?Z=i.onmouseout:(Z=i.onmouseout,le(y.table,"mouseout",function(e){Z.call(y,e)},!1),se.onmouseout=!0),p.style.cursor="default"):se.onmouseout&&(Z=function(){},se.onmouseout=!1),i.onmousewheel?($?$=i.onmousewheel:($=i.onmousewheel,le(y.table,"mousewheel",function(e){$.call(y,e)},!1),se.onmousewheel=!0),p.style.cursor="default"):se.onmousewheel&&($=function(){},se.onmousewheel=!1),i.oncontextmenu?(ee?ee=i.oncontextmenu:(ee=i.oncontextmenu,le(y.table,"contextmenu",function(e){ee.call(y,e)},!1),se.oncontextmenu=!0),p.style.cursor="default"):se.oncontextmenu&&(ee=function(){},se.oncontextmenu=!1),i.ontouchstart?te?te=i.ontouchstart:(te=i.ontouchstart,le(y.table,"touchstart",function(e){te.call(y,e)},!1),se.ontouchstart=!0):se.ontouchstart&&(te=function(){},se.ontouchstart=!1),i.ontouchmove?ie?ie=i.ontouchmove:(ie=i.ontouchmove,le(y.table,"touchmove",function(e){ie.call(y,e)},!1),se.ontouchmove=!0):se.ontouchmove&&(ie=function(){},se.ontouchmove=!1),i.ontouchend?oe?oe=i.ontouchend:(oe=i.ontouchend,le(y.table,"touchend",function(e){oe.call(y,e)},!1),se.ontouchend=!0):se.ontouchend&&(oe=function(){},se.ontouchend=!1),w=i.delay||w,y.delay=w,y.flashEndingPosition=0,y.defaultColor=i.defaultColor||i.gray||A,y.white=i.white||X,y.black=i.black||D,y.gray=i.gray||Y,y.red=i.red||E,y.green=i.green||F,y.blue=i.blue||B,y.yellow=i.yellow||L,y.purple=i.purple||R,y.blueGreen=i.blueGreen||O,W=i.hideOnPause||W,l=p.rows,n=l[0].length,h=l.length;var I=0,re=0;e:for(var ne=0,ce=l.length;ce>ne;ne++){for(var ge=[],ye=0,pe=l[ne].cells.length;pe>ye;ye++){if(l[ne].cells[ye].getAttribute("colspan")&&parseInt(l[ne].cells[ye].getAttribute("colspan"),10)>1)continue e;ge.push(l[ne].cells[ye]),l[ne].cells[ye].style.background="transparent"}u.push(ge),I++,re=Math.max(re,l[ne].cells.length)}return H=y.screenHeight=I,G=y.screenWidth=re,S=i.update,k=i.onpause,C=i.onunpause,M=i.onpaint,i.init.call(y),y.paint(),setTimeout(function(){v=setInterval(ae,w)},i.initialDelay||20),y};he.prototype.constructor=he,he.defaultColor=A,he.black=D,he.gray=Y,he.red=E,he.green=F,he.blue=B,he.yellow=L,he.purple=R,he.blueGreen=O;var ae=function(){b||P||(x++,S.call(y),y.paint())};he.prototype.setTimeout=function(t,i){return P=i,e.setTimeout(function(){P=0,t.call(y)},i),this},he.prototype.getDelay=function(){return w},he.prototype.setDelay=function(e){return clearInterval(v),w=e,v=setInterval(ae,w),this};var ce=function(e){var i={name:t,x:0,y:0,velocityX:0,velocityY:0,width:1,height:1,color:A,polygon:[]},o=this;for(var s in i)o[s]=e[s]||i[s];0===e.width&&(o.width=0),0===e.height&&(o.height=0),o.shiftPolygons=function(e,t,i){if(i)if("function"==typeof t)for(var s=0,r=o.polygon.length;r>s;s++)o.polygon[s][e]=t.call(o,o.polygon[s][e]);else for(var s=0,r=o.polygon.length;r>s;s++)o.polygon[s][e]=t;else if("function"==typeof t)for(var s=0,r=o.polygon.length;r>s;s++)o.polygon[s][e]+=t.call(o,o.polygon[s][e]);else for(var s=0,r=o.polygon.length;r>s;s++)o.polygon[s][e]+=t}};he.prototype.registerSprites=function(e,t){if("string"==typeof e)t=t||{},t.name=e,m[e]=new ce(t);else for(var i in e)e[i]=e[i]||{},e[i].name=i,m[i]=new ce(e[i]);return this},he.prototype.unregisterSprite=function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)"string"==typeof arguments[t]?delete m[arguments[t]]:delete m[arguments[t]];else"string"==typeof e?delete m[e]:delete m[e.name];return this},he.prototype.getSprites=function(e){var t={};if(e){if(e instanceof RegExp){for(var i in m)e.test(i)&&(t[i]=m[i]);return t}return m[e]}return m},he.prototype.registerGlobals=function(e,t){if("string"==typeof e)f[e]=t;else for(var i in e)f[i]=e[i];return this},he.prototype.unregisterGlobals=function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)delete f[arguments[t]];else delete f[e]},he.prototype.getGlobals=function(e){var t={};if(e){if(e instanceof RegExp){for(var i in f)e.test(i)&&(t[i]=f[i]);return t}return f[e]}return f},he.prototype.setGlobals=function(e,t){if("string"==typeof e)f[e]=t;else for(var i in e)f[i]=e[i];return this},he.prototype.getTable=function(){return p},he.prototype.getTableArr=function(){return u},he.prototype.getCellAt=function(e,t){return 0>e||0>t||e>G||t>H?{style:{color:"",backgroundColor:""}}:u[t][e]},he.prototype.colliding=function(e,t,i,o,s,r,l,n){if("object"==typeof e){var h=e,a=t;return a?h.polygon&&h.polygon.length||a.polygon&&a.polygon.length?this.collidingPolygons(h,a):this.colliding(h.x,h.y,h.width,h.height,a.x,a.y,a.width,a.height):!1}return s+l>e&&e+i>s&&r+n>t&&t+o>r?!0:!1},he.prototype.collidingPolygons=function(e,t){if(!(e.polygon&&e.polygon.length||t.polygon&&t.polygon.length))return this.collidingPolygons({polygon:[{x:e.x,y:e.y,width:e.width,height:e.height}]},{polygon:[{x:t.x,y:t.y,width:t.width,height:t.height}]});if(!e.polygon||!e.polygon.length)return this.collidingPolygons({polygon:[{x:e.x,y:e.y,width:e.width,height:e.height}]},t);if(!t.polygon||!t.polygon.length)return this.collidingPolygons(e,{polygon:[{x:t.x,y:t.y,width:t.width,height:t.height}]});for(var i="",o=0,s=e.polygon.length;s>o;o++)i+="_"+e.polygon[o].x+"&"+e.polygon[o].y+"_";for(var o=0,s=t.polygon.length;s>o;o++)if(~i.indexOf("_"+t.polygon[o].x+"&"+t.polygon[o].y+"_"))return!0;return!1},he.prototype.collidingFromLeft=function(e,t){return 0!==e.velocityX?this.colliding(e.x+Math.abs(e.velocityX),e.y,e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x+1,e.y,e.width,e.height,t.x,t.y,t.width,t.height)},he.prototype.collidingFromRight=function(e,t){return 0!==e.velocityX?this.colliding(e.x-Math.abs(e.velocityX),e.y,e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x-1,e.y,e.width,e.height,t.x,t.y,t.width,t.height)},he.prototype.collidingFromAbove=function(e,t){return 0!==e.velocityY?this.colliding(e.x,e.y+Math.abs(e.velocityY),e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x,e.y+1,e.width,e.height,t.x,t.y,t.width,t.height)},he.prototype.collidingFromBelow=function(e,t){return 0!==e.velocityY?this.colliding(e.x,e.y-Math.abs(e.velocityY),e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x,e.y-1,e.width,e.height,t.x,t.y,t.width,t.height)},he.prototype.touching=function(e,t,i){if(Math.abs(e.x-t.x)>1||Math.abs(e.y-t.y)>1)return!1;if(i){var o={x:t.x-1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0},s={x:t.x+1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0},r={x:t.x-1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0},l={x:t.x+1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0};return this.collidingFromAbove(e,t)||this.collidingFromBelow(e,t)||this.collidingFromLeft(e,t)||this.collidingFromRight(e,t)||this.collidingFromBelow(e,o)||this.collidingFromBelow(e,s)||this.collidingFromAbove(e,r)||this.collidingFromAbove(e,l)}return this.collidingFromAbove(e,t)||this.collidingFromBelow(e,t)||this.collidingFromLeft(e,t)||this.collidingFromRight(e,t)},he.prototype.clear=function(){for(var e=0;e<u.length;e++)for(var t=0;t<u[e].length;t++)u[e][t].style.background="transparent";return this},he.prototype.fillRect=function(e,t,i,o,s){if(s=s||A,0===i)for(var r=t,l=Math.min(t+o,H);l>r;r++)for(var n=e,h=Math.min(e+i,G);h>n;n++)this.getCellAt(n,r).style["border-left"]="1px solid "+s;else if(0===o)for(var r=t,l=Math.min(t+o,H);l>r;r++)for(var n=e,h=Math.min(e+i,G);h>n;n++)this.getCellAt(n,r).style["border-top"]="1px solid "+s;else for(var r=t,l=Math.min(t+o,H);l>r;r++)for(var n=e,h=Math.min(e+i,G);h>n;n++)this.getCellAt(n,r).style.backgroundColor=s;return this},he.prototype.fillPolygon=function(e,t){for(var i=0,o=e.length;o>i;i++)this.fillRect(e[i].x,e[i].y,e[i].width,e[i].height,e[i].color||t);return this},he.prototype.paint=function(){if(this.clear(),!b||!W)for(var e in m)m[e].polygon.length?this.fillPolygon(m[e].polygon,m[e].color):this.fillRect(m[e].x,m[e].y,m[e].width,m[e].height,m[e].color);return this.onpaint(),this},he.prototype.pause=function(){return W&&(this.clear(),this.detailsDiv.style.display="none"),this.onpause(),b=!0,clearInterval(v),this},he.prototype.unpause=function(){return this.onunpause(),b=!1,(this.detailsDiv.style.display="none")&&(this.detailsDiv.style.display="inline block"),v=setInterval(ae,w),this},he.prototype.isPaused=function(){return b},he.prototype.onpause=function(){k.call(this)},he.prototype.onunpause=function(){C.call(this)},he.prototype.onpaint=function(){M.call(this)},he.prototype.getDetails=function(e){if("undefined"==typeof e){var t={};for(var i in details)t[i]=this.details[i];return t}return this.details[e]},he.prototype.setDetails=function(e,t){if("object"==typeof e)for(var i in e)this.details[i]=e[i],document.getElementById("Table2Game"+i+"Span").innerHTML=e[i];else this.details[e]=t,document.getElementById("Table2Game"+e+"Span").innerHTML=t;return this},he.prototype.getDetailsElement=function(e){return e?document.getElementById("Table2Game"+e+"Span").innerHTML:this.detailsDiv},he.prototype.closestCell=function(e){var t="",i=e;if(!i)return null;if("TD"===i.nodeName||"TH"===i.nodeName)return i;for(;i.parentNode&&"TD"!==t&&"TH"!==t&&"TABLE"!==t;){try{i=i.parentNode,nameName=i.nodeName}catch(o){break}}return"TD"===t||"TH"===t?i:null},he.prototype.getCellCoords=function(e){for(var t=this.getTableArr(),i=0;i<t.length;i++)if(-1!==t[i].indexOf(e))return{x:t[i].indexOf(e),y:i};return-1},he.prototype.moveToTop=function(e){var t=this.getSprites(e),i={};for(var o in t)"object"==typeof o&&"undefined"!=typeof JSON?i[o]=JSON.parse(JSON.stringify(t[o])):i[o]=t[o];return this.unregisterSprite(e).registerSprites(e,i)},he.prototype.flashEnding=function(e,t,i){var t=t||150,e=e||5,o=this,s=(2*e-1)*t;if(!o.flashEndingPosition){for(var r=0;2*e>r;r+=2)setTimeout(function(){o.pause()},t*r),setTimeout(function(){o.unpause(),o.paint()},t*(r+1));this.flashEndingPosition=1}setTimeout(function(){o.flashEndingPosition=2,i&&i.call(o)},s)},d["Ping Pong"].init=function(){this.registerSprites("leftPaddle",{x:0,y:2,width:1,height:3,velocityX:0,velocityY:0,color:this.defaultColor}),this.registerSprites("rightPaddle",{x:this.screenWidth-1,y:2,width:1,height:3,velocityX:0,velocityY:0,color:this.defaultColor}),this.registerSprites("ball",{x:3,y:2,velocityX:1,velocityY:1})},d["Ping Pong"].details={Score:0,Lives:3},d["Ping Pong"].update=function(){var e=this.getSprites("ball"),t=this.getSprites("leftPaddle"),i=this.getSprites("rightPaddle"),o=this;if(e){if(e.velocityX>0)if(this.collidingFromLeft(e,i))e.velocityX*=-1,e.x+=e.velocityX;else if(e.x+e.velocityX<=this.screenWidth)e.x+=e.velocityX;else{if(e.color="#ffdddd",e.velocityX*=-1,o.setDetails("Lives",o.getDetails("Lives")-1),0===o.getDetails("Lives"))return o.unregisterSprite("ball"),void o.flashEnding();o.setTimeout(function(){e.x=Math.ceil(o.screenWidth/2),o.paint(),o.setTimeout(function(){e.color="#eee"},500)},500)}else if(e.velocityX<0)if(this.collidingFromRight(e,t))e.velocityX*=-1,e.x+=e.velocityX;else if(e.x>=0)e.x+=e.velocityX;else{if(e.color="#ddffdd",e.velocityX*=-1,o.setDetails("Score",o.getDetails("Score")+100),o.getDetails("Score")>=1e3)return o.unregisterSprite("ball"),void o.flashEnding(3,300);o.setTimeout(function(){e.x=Math.floor(o.screenWidth/2),o.paint(),o.setTimeout(function(){e.color="#eee"},500)},500)}e.velocityY>0?e.y+e.velocityY<this.screenHeight?e.y+=e.velocityY:(e.velocityY*=-1,e.y+=e.velocityY):e.velocityY<0&&(e.y>0?e.y+=e.velocityY:(e.velocityY*=-1,e.y+=e.velocityY)),updateAIPaddle.call(o,e,t)}},updateAIPaddle=function(e,t){10*Math.random()<5||(t.y+1<e.y?t.y+t.height<this.screenHeight&&t.y++:t.y>0&&t.y--)},d["Ping Pong"].delay=100,d["Ping Pong"].onkeydown=function(e){var t=this.getSprites("rightPaddle");switch(e.keyCode){case 38:case 87:t.y>0&&t.y--;break;case 40:case 83:t.y+t.height<this.screenHeight&&t.y++;break;case 32:this.isPaused()?this.unpause():this.pause()}this.paint()},d.Snake.init=function(){this.registerSprites("snake",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),width:1,height:1,velocityX:1,velocityY:0,polygon:[{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),width:1,height:1}]}),this.registerGlobals("timeCount",0)},d.Snake.details={Score:0,Lives:3};var ge=function(e){for(var t=!0,i=0,o=0,s=0;t&&100>s;)i=Math.floor(Math.random()*this.screenWidth),o=Math.floor(Math.random()*this.screenHeight),this.colliding({polygon:e},{polygon:[{x:i,y:o,width:1,height:1}]})||(i!==Math.floor(this.screenWidth/2)||o!==Math.floor(this.screenHeight/2))&&(t=!1),s++;this.registerSprites("block"+Object.keys(this.getSprites()).length,{x:i,y:o,width:1,height:1,color:"#ddd"})};d.Snake.update=function(){var e=this.getSprites("snake");if(e){var t=e.polygon[e.polygon.length-1].x,i=e.polygon[e.polygon.length-1].y,o=0;this.setGlobals("timeCount",this.getGlobals("timeCount")+1),this.getGlobals("timeCount")%15===14&&Object.keys(this.getSprites()).length<2&&ge.call(this,e.polygon);for(var o=e.polygon.length;o-->1;)e.polygon[o].x=e.polygon[o-1].x,e.polygon[o].y=e.polygon[o-1].y;if(e.polygon[0].x+=e.velocityX,e.polygon[0].y+=e.velocityY,e.polygon[0].x<0||e.polygon[0].y<0||e.polygon[0].x>=this.screenWidth||e.polygon[0].y>=this.screenHeight||this.colliding({polygon:[e.polygon[0]]},{polygon:e.polygon.slice(3)}))if(e.shiftPolygons("color","#ffdddd",!0),this.setDetails("Lives",this.getDetails("Lives")-1),0===this.getDetails("Lives"))this.setTimeout(function(){ye.call(this,e)},500);else{var s=this;s.flashEnding(null,null,function(){s.unregisterSprite("snake")})}else{var r=this.getSprites();for(var l in r)"snake"!==l&&this.colliding(e,r[l])&&(e.polygon.push({x:t,y:i,width:1,height:1}),this.unregisterSprite(l),this.setDetails("Score",this.getDetails("Score")+100))}}};var ye=function(e){e.x=Math.floor(this.screenWidth/2),e.y=Math.floor(this.screenHeight/2),e.width=1,e.height=1,e.velocityX=1,e.velocityY=0,e.polygon=[{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),width:1,height:1}],e.color="#ffdddd",thie.setDetails({Score:0,Lives:3}),this.setTimeout(function(){e.color="#eee"},500)};d.Snake.onkeydown=function(e){var t=this.getSprites("snake");switch(e.keyCode){case 38:case 87:t.velocityX=0,t.velocityY=-1;break;case 40:case 83:t.velocityX=0,t.velocityY=1;break;case 37:case 65:t.velocityX=-1,t.velocityY=0;break;case 39:case 68:t.velocityX=1,t.velocityY=0;break;case 32:this.isPaused()?this.unpause():this.pause()}},d.Snake.delay=180,d["Break Bricks"].init=function(){this.registerGlobals({score:0,lives:0}),this.registerSprites("paddle",{x:Math.floor(this.screenWidth/2),y:this.screenHeight-1,velocityX:0,velocityY:0,width:3,height:1});for(var e=0;3>e;e++)for(var t=0;t<this.screenWidth;t++)this.registerSprites("block_"+e+"_"+t,{x:t,y:e,velocityX:0,velocityY:0,width:1,height:1});this.registerSprites("ball",{x:Math.floor(this.screenWidth/2)+1,y:this.screenHeight-2,velocityX:0,velocityY:0,width:1,height:1,color:"#ddd"})},d["Break Bricks"].details={Lives:3,Score:0},d["Break Bricks"].onkeydown=function(e){var t=this.getSprites("paddle"),i=this.getSprites("ball");switch(e.keyCode){case 38:case 87:i.y===t.y-1&&i.x>=t.x&&i.x<t.x+t.width&&(i.velocityY=-1,2*Math.random()<1?i.velocityX++:i.velocityX--);break;case 37:case 65:t.x>0&&(i.y===t.y-1&&i.x>=t.x&&i.x<t.x+t.width&&!i.velocityX&&i.x--,t.x--);break;case 39:case 68:t.x+t.width<this.screenWidth&&(i.y===t.y-1&&i.x>=t.x&&i.x<t.x+t.width&&!i.velocityX&&i.x++,t.x++);break;case 32:this.isPaused()?this.unpause():this.pause()}},d["Break Bricks"].update=function(){var e=this.getSprites("ball"),t=this.getSprites(/block/),i=this.getSprites("paddle");if(e){e.y+e.velocityY>=0?e.y+=e.velocityY:(e.velocityY*=-1,e.y+=e.velocityY),e.velocityX>0?e.x+e.width<this.screenWidth?e.x+=e.velocityX:(e.velocityX*=-1,e.x+=e.velocityX):e.velocityX<0&&(e.x>0?e.x+=e.velocityX:(e.velocityX*=-1,e.x+=e.velocityX));for(var o in t)if(this.touching(e,t[o],!0)&&(e.velocityX*=-1,e.velocityY=Math.abs(e.velocityY),this.unregisterSprite(o),this.setDetails("Score",this.getDetails("Score")+100),0===Object.keys(this.getSprites(/block/)).length))return this.unregisterSprite("ball"),void this.flashEnding(3,200);if(this.collidingFromBelow(i,e)&&(e.velocityY=-Math.abs(e.velocityY)),e.y>this.screenHeight+2){e.velocityY=0,e.velocityX=0,e.y=this.screenHeight-2,e.x=i.x+1;var s=this.getDetails("Lives");this.setDetails("Lives",--s),0>=s&&(this.unregisterSprite("ball"),this.flashEnding(3,400))}}},d["Break Bricks"].delay=200,d["Whack-a-mole"].init=function(){this.registerGlobals({timeCount:0,currentWait:20,gameOver:!1})},d["Whack-a-mole"].details={Score:0},d["Whack-a-mole"].update=function(){if(this.getGlobals("gameOver")!==!0){var e=this.getGlobals("timeCount"),t=this.getGlobals("currentWait");return this.setGlobals("timeCount",e+1),e++,e%t===0&&pe.call(this),1e3===e?de.call(this):(e%100===0&&this.setGlobals("currentWait",t-1),Object.keys(this.getSprites()).length>10?ue.call(this):void 0)}};var pe=function(){for(var e=(this.getSprites(/mole_/g),!0),t=0,i=0,o=0;e&&100>o;)t=Math.floor(Math.random()*this.screenWidth),i=Math.floor(Math.random()*this.screenHeight),this.getSprites("mole_"+t+"_"+i)||(e=!1);this.registerSprites("mole_"+t+"_"+i,{x:t,y:i})},de=function(){this.setGlobals("gameOver",!0),this.registerSprites("gameOverIndicator",{x:0,y:0,width:1,height:1,color:"#ddffdd"})},ue=function(){this.setGlobals("gameOver",!0),this.registerSprites("gameOverIndicator",{x:0,y:0,width:1,height:1,color:"#ffdddd"})};d["Whack-a-mole"].onclick=function(e){var t=this.closestCell(e.target),i=this.getCellCoords(t),o=i.x,s=i.y;this.getSprites("mole_"+o+"_"+s)&&(this.setDetails("Score",this.getDetails("Score")+100),this.unregisterSprite("mole_"+o+"_"+s))},d.Paint.init=function(){var t=this,i=document.createElement("input"),o=document.createElement("div"),s=t.getTable();i.type="color",t.registerGlobals("paintedCount",0),i.style.marginLeft=t.table.style.marginLeft||(e.getComputedStyle?e.getComputedStyle(t.table).getPropertyValue("margin-left"):""),i.onchange=function(e){t.setGlobals("storedColor",this.value)};this.getDetailsElement();s.style.marginBottom="0",o.appendChild(i),s.parentNode.insertBefore(o,s.nextSibling),t.registerGlobals({colorInput:i,colorElm:o,storedColor:"#000000",overTable:!1,overColorElm:!1}),le(o,"mouseleave",function(){t.setGlobals("overColorElm",!1),t.getGlobals("overTable")||t.pause()},!1),le(o,"mouseenter",function(){t.setGlobals("overColorElm",!0),t.unpause()},!1)},d.Paint.onpause=function(){this.getGlobals("colorInput").style.display="none"},d.Paint.onunpause=function(){this.getGlobals("colorInput").style.display="block"},d.Paint.onmouseleave=function(e){this.setGlobals("overTable",!1),y.getGlobals("overColorElm")||y.pause()},d.Paint.onmouseenter=function(e){this.setGlobals("overTable",!0),this.unpause()},d.Paint.onclick=function(e){fe.call(this,e)},d.Paint.onmousedrag=function(e){fe.call(this,e)};var fe=function(e){var t=(this.getGlobals("colorInput"),this.closestCell(e.target)),i=this.getGlobals("paintedCount");this.registerSprites("paintedCount"+i,{x:this.getCellCoords(t).x,y:this.getCellCoords(t).y,width:1,height:1,color:this.getGlobals("storedColor")}),this.setGlobals("paintedCount",i+1)};d.Maze.init=function(){this.registerSprites("wall1",{x:0,y:0,width:3,height:1}).registerSprites("wall2",{x:6,y:0,width:1,height:1}).registerSprites("wall3",{x:1,y:2,width:3,height:1}).registerSprites("wall4",{x:8,y:1,width:1,height:1}).registerSprites("wall5",{x:4,y:1,width:1,height:4}).registerSprites("wall6",{x:0,y:4,width:3,height:1}).registerSprites("wall7",{x:5,y:2,width:3,height:1}).registerSprites("wall8",{x:9,y:0,width:1,height:this.screenHeight}).registerSprites("wall9",{
x:0,y:6,width:this.screenWidth,height:1}).registerSprites("wall10",{x:5,y:4,width:3,height:1}).registerSprites("goal",{x:8,y:0,width:1,height:1,color:"#ddffdd"}).registerSprites("player",{x:0,y:5,width:1,height:1,color:"#ddd"})},d.Maze.onkeydown=function(e){var t=this.getSprites("player"),l=this.getSprites("goal");switch(e.keyCode){case 38:case 87:i.call(this)&&t.y--;break;case 40:case 83:o.call(this)&&t.y++;break;case 37:case 65:s.call(this)&&t.x--;break;case 39:case 68:r.call(this)&&t.x++;break;case 32:this.isPaused()?this.unpause():this.pause()}this.colliding(t,l)&&this.flashEnding()},d["Creepy Crawler"].init=function(){this.registerSprites("crawler",{velocityX:1,x:-1,y:-1,polygon:[{x:3,y:0,width:1,height:1},{x:2,y:0,width:1,height:1},{x:1,y:0,width:1,height:1},{x:0,y:0,width:1,height:1}]}),this.registerSprites("player",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight-1),width:1,height:1})},d["Creepy Crawler"].details={Score:0},d["Creepy Crawler"].update=function(){var e=this.getSprites("crawler"),t=e.polygon.length,i=this.getSprites(/playerBullet/),o=this.getSprites("player");if(e.polygon.length){for(;t-->1;)e.polygon[t].x=e.polygon[t-1].x,e.polygon[t].y=e.polygon[t-1].y;e.velocityX>0?e.polygon[0].x+e.velocityX<this.screenWidth?e.polygon[0].x+=e.velocityX:(e.polygon[0].y++,e.velocityX*=-1):e.polygon[0].x+e.velocityX>=0?e.polygon[0].x+=e.velocityX:(e.polygon[0].y++,e.velocityX*=-1);for(var s in i)this.colliding(i[s],e)&&(e.polygon.pop(),this.unregisterSprite(i[s].name));if(e.polygon.length||this.flashEnding(3,400),this.colliding(o,e)||e.y>this.screenHeight){var r=this;this.flashEnding(null,null,function(){r.unregisterSprite("crawler")})}}},d["Creepy Crawler"].delay=200,d["Creepy Crawler"].onkeydown=function(e){var t=(this.getSprites("crawler"),this.getSprites("player")),i=this.delay;switch(e.keyCode){case 38:case 87:var o=new l({x:t.x,y:t.y-1,velocityX:0,velocityY:-1},this);setTimeout(function(){o.moveY()},i);break;case 40:case 83:break;case 37:case 65:t.x>0&&t.x--;break;case 39:case 68:t.x+t.width<this.screenWidth&&t.x++;break;case 32:this.isPaused()?this.unpause():this.pause()}};var me=4,ve=0;d.Jumper.init=function(){this.registerSprites("player",{x:2,y:this.screenHeight-2,width:1,height:1,velocityX:0,velocityY:0}).registerSprites("ground",{x:0,y:this.screenHeight-1,width:this.screenWidth,height:1,velocityX:0,velocityY:0}).registerGlobals("awaitingReset",!1).registerGlobals("walls",{}).registerGlobals("timeCount",0),xe.call(this)},d.Jumper.details={Score:0},d.Jumper.update=function(){var e=this.getSprites(),t=this.getGlobals("timeCount"),i=this.getGlobals("awaitingReset"),o=this.getGlobals("walls"),s=this.getSprites("player");this.setGlobals("timeCount",t+1);for(var r in e)"player"!==r&&"ground"!==r&&(e[r].x+=e[r].velocityX,e[r].y+=e[r].velocityY,e[r].x<0&&(this.unregisterSprite(r),this.setDetails("Score",this.getDetails("Score")+100)));if(o[t]&&this.registerSprites("hurdle"+(e["hurdle"+t]?t+""+parseInt(100*Math.random()):t),{x:this.screenWidth-1,y:"undefined"==typeof o[t].y?this.screenHeight-1-o[t].height:o[t].y,width:1,height:o[t].height,velocityX:-1,velocityY:0}),be.call(this)?(s.velocityY<0&&me>ve?(s.y+=s.velocityY,ve++):(s.velocityY=Math.abs(s.velocityY),s.y+=s.velocityY),s.velocityY>0&&this.collidingFromAbove(s,e.ground)&&(s.velocityY=0,ve=0)):s.velocityY<0?s.velocityY*=-1:(s.velocityY=0,ve=0),!i)for(var r in e)"player"!==r&&"ground"!==r&&this.colliding(s,e[r])&&(this.setGlobals("awaitingReset",!0),this.flashEnding(null,null,xe));this.getGlobals("timeCount")+this.screenWidth===231&&this.flashEnding(3,400)};var xe=function(){var e=this.screenHeight-7,t={8:{height:3},18:{height:2},30:{height:3},40:{height:4},48:{height:3},60:{height:2},61:{y:0,height:e+2},70:{height:2},80:{height:4},90:{height:1},100:{height:2},101:{height:2},109:{height:3},112:{height:5},118:{height:2},121:{height:1},123:{height:1},127:{y:0,height:e+4},130:{height:2},144:{height:1},145:{y:1,height:e+1},146:{height:1},147:{y:1,height:e+2},148:{y:2,height:e+2},149:{y:3,height:e+1},160:{height:1},164:{height:2},170:{height:3},178:{height:2},178:{y:0,height:this.screenHeight-2},188:{height:2},194:{height:1},196:{height:2},198:{height:3},200:{height:5}},i=this.getSprites("player"),o=this.getSprites(/hurdle/);for(var s in o)this.unregisterSprite(s);this.flashEndingPosition=0,this.setGlobals("walls",t).setGlobals("timeCount",0).setGlobals("awaitingReset",!1),i.x=2,i.y=this.screenHeight-2,i.velocityY=0},be=function(){var e=this.getSprites(),t=e.player;if(this.collidingFromAbove(t,e.ground))return!0;for(var i in e)if("player"!==i&&"ground"!==i&&this.collidingFromAbove(t,e[i]))return!0;return!0},Se=function(){var e=this.getSprites(),t=e.player;for(var i in e)if("player"!==i&&this.collidingFromAbove(t,e[i]))return!0;return!1};d.Jumper.delay=100,d.Jumper.onkeydown=function(e){var t=this.getSprites("player");switch(e.keyCode){case 38:case 87:Se.call(this)&&(ve=0,t.velocityY=-1);break;case 37:case 65:t.x>0&&!t.velocityY&&t.x--;break;case 39:case 68:t.x<3&&!t.velocityY&&t.x++;break;case 32:this.isPaused()?this.unpause():this.pause()}},d.Sniper.init=function(){var e=parseInt(this.screenWidth/2,10),t=parseInt(this.screenHeight/2,10);this.registerGlobals("shootingSpot",0).registerGlobals("timeCount",0).registerSprites("enemy0",{x:2,y:2,width:1,height:1,color:"#ffdddd"}).registerSprites("enemy1",{x:Math.ceil(this.screenWidth/2),y:2,width:1,height:1,color:"#ddffdd"}).registerSprites("enemy2",{x:2*Math.floor(this.screenWidth/3),y:Math.ceil(this.screenHeight/2),width:1,height:1,color:"#ddddff"}).registerSprites("enemy3",{x:Math.ceil(this.screenWidth/3),y:Math.ceil(this.screenHeight/2),width:1,height:1,color:"#fdddbb"}).registerGlobals("scopeCoords",{x:1,y:1}),this.registerSprites("scopePart0",{x:0,y:0,width:7,height:1,color:"#eee"}),this.registerSprites("scopePart1",{x:0,y:1,width:3,height:1,color:"#eee"}),this.registerSprites("scopePart2",{x:4,y:1,width:3,height:1,color:"#eee"}),this.registerSprites("scopePart3",{x:0,y:2,width:2,height:1,color:"#eee"}),this.registerSprites("scopePart4",{x:5,y:2,width:2,height:1,color:"#eee"}),this.registerSprites("scopePart5",{x:0,y:3,width:1,height:1,color:"#eee"}),this.registerSprites("scopePart6",{x:6,y:3,width:1,height:1,color:"#eee"}),this.registerSprites("scopePart7",{x:0,y:4,width:2,height:1,color:"#eee"}),this.registerSprites("scopePart8",{x:5,y:4,width:2,height:1,color:"#eee"}),this.registerSprites("scopePart9",{x:0,y:5,width:3,height:1,color:"#eee"}),this.registerSprites("scopePart10",{x:4,y:5,width:3,height:1,color:"#eee"}),this.registerSprites("scopePart11",{x:0,y:6,width:7,height:1,color:"#eee"}),this.registerSprites("scopePartTop",{x:0,y:-1*t,width:7,height:t,color:"#eee"}),this.registerSprites("scopePartLeft",{x:-1*e,y:-1*t,width:e,height:2*this.screenHeight,color:"#eee"}),this.registerSprites("scopePartRight",{x:7,y:-1*t,width:e,height:2*this.screenHeight,color:"#eee"}),this.registerSprites("scopePartBottom",{x:0,y:6,width:7,height:t,color:"#eee"})},d.Sniper.details={Score:0},d.Sniper.update=function(){var e=this.getGlobals("scopeCoords"),t=this.getGlobals("shootingSpot"),i=this.getSprites(/enemy/),o=this.getGlobals("timeCount");if(o++,this.setGlobals("timeCount",o),t){if(1===t)for(var s in i)this.colliding({polygon:[{x:e.x+2,y:e.y+2,width:1,height:1}]},i[s])&&(this.setDetails("Score",this.getDetails("Score")+100),this.unregisterSprite(s));t--,this.setGlobals("shootingSpot",t),i=this.getSprites(/enemy/),Object.keys(i).length||this.flashEnding(3,200)}for(var s in i){var r=Math.floor(2.9*Math.random())-1,l=Math.round(Math.random()*o)%2,n=Math.floor(2.9*Math.random())-1,h=Math.round(Math.random()*o)%2,a=Math.random()*(o%10);i[s].x+r>=2&&i[s].x+r<this.screenWidth-3&&l&&1>a&&(i[s].x+=r),i[s].y+n>=2&&i[s].y+n<this.screenHeight-3&&h&&1>a&&(i[s].y+=n)}},d.Sniper.onpaint=function(){var e=this.getGlobals("scopeCoords"),t=this.getGlobals("shootingSpot");switch(t){case 3:this.fillRect(e.x+2,e.y,1,1),this.fillRect(e.x+1,e.y+1,3,1),this.fillRect(e.x,e.y+2,5,1),this.fillRect(e.x+1,e.y+3,3,1),this.fillRect(e.x+2,e.y+4,1,1);break;case 2:this.fillRect(e.x+2,e.y+1,1,1),this.fillRect(e.x+1,e.y+2,3,1),this.fillRect(e.x+2,e.y+3,1,1);break;case 1:this.fillRect(e.x+2,e.y+2,1,1)}},d.Sniper.delay=50,d.Sniper.onkeydown=function(e){var t=(this.getSprites(/scopePart/),this.getGlobals("scopeCoords")),i=this.getGlobals("shootingSpot");switch(e.keyCode){case 38:case 87:t.y>0&&we.call(this,0,-1);break;case 40:case 83:t.y+5<this.screenHeight&&we.call(this,0,1);break;case 37:case 65:t.x>0&&we.call(this,-1,0);break;case 39:case 68:t.x+5<this.screenWidth&&we.call(this,1,0);break;case 13:i||this.setGlobals("shootingSpot",4);break;case 32:this.isPaused()?this.unpause():this.pause()}};var we=function(e,t){var i=this.getSprites(/scopePart/),o=this.getGlobals("scopeCoords");o.x+=e,o.y+=t;for(var s in i)i[s].x+=e,i[s].y+=t},ke="#333",Ce="#000",We=he.gray,Me={left:0,right:0,top:0,bottom:0};d.Dungeon.init=function(){var e={x:1,y:3};this.registerGlobals({roomCoords:e,startingColor:"#ddd",roomTimeCount:0,gameOver:!1,hasKey:!1,hasBlock:!1}),this.registerGlobals("blockCoords",{blockCoords:{x:Math.floor(this.screenWidth/2),y:3,color:We},mapCoords:{x:3,y:0}}),this.registerGlobals("doorCoords",{left:{x:0,y:Math.floor(this.screenHeight/2)},top:{x:Math.floor(this.screenWidth/2),y:0},bottom:{x:Math.floor(this.screenWidth/2),y:this.screenHeight-1},right:{x:this.screenWidth-1,y:Math.floor(this.screenHeight/2)}}),this.registerSprites("player",{x:Math.floor(this.screenWidth/2),y:Math.ceil(this.screenHeight/2),width:1,height:1,color:"#ddd"}),this.registerSprites("topWall",{x:0,y:0,width:this.screenWidth,height:1}),this.registerSprites("bottomWall",{x:0,y:this.screenHeight-1,width:this.screenWidth,height:1}),this.registerSprites("leftWall",{x:0,y:0,width:1,height:this.screenHeight}),this.registerSprites("rightWall",{x:this.screenWidth-1,y:0,width:1,height:this.screenHeight}),n.call(this,e)},d.Dungeon.onkeydown=function(e){var t=this.getSprites("player"),i=this.getSprites("topDoor"),o=this.getSprites("rightDoor"),s=this.getSprites("bottomDoor"),r=this.getSprites("leftDoor"),l=this.getSprites("block"),n=this.getGlobals("blockCoords"),a=this.getSprites("key"),c=this.getGlobals("hasKey"),g=this.getSprites("keyhole"),y=this.getGlobals("hasBlock"),p=this.getGlobals("gameOver");switch(e.keyCode){case 38:case 87:if(g&&c&&this.collidingFromBelow(t,g)&&(this.unregisterSprite("keyhole"),t.y--,t.color=this.getGlobals("startingColor")),l&&this.collidingFromBelow(t,l))return y&&(t.y>1||i&&this.collidingFromBelow(t,i))&&!p?(t.y--,void(this.colliding(t,l)&&(l.y--,this.setGlobals("hasBlock",!1),this.colliding(l,i)&&(n.mapCoords.y--,n.blockCoords.y=this.screenHeight-3,this.unregisterSprite("block"))))):void(Me.bottom||Me.bottom++);(t.y>1||i&&this.collidingFromBelow(t,i))&&!p&&t.y--;break;case 40:case 83:if(l&&this.collidingFromAbove(t,l))return y&&(t.y<this.screenHeight-2||s&&this.collidingFromAbove(t,s))&&!p?(t.y++,void(this.colliding(t,l)&&(l.y++,this.setGlobals("hasBlock",!1),this.colliding(l,s)&&(n.mapCoords.y++,n.blockCoords.y=2,this.unregisterSprite("block"))))):void(Me.top||Me.top++);(t.y<this.screenHeight-2||s&&this.collidingFromAbove(t,s))&&t.y++;break;case 37:case 65:if(l&&this.collidingFromRight(t,l))return y&&(t.x>1||r&&this.collidingFromRight(t,r)||p)?(t.x--,void(this.colliding(t,l)&&(l.x--,this.setGlobals("hasBlock",!1),this.colliding(l,r)&&(n.mapCoords.x--,n.blockCoords.x=this.screenWidth-3,this.unregisterSprite("block"))))):void(Me.right||Me.right++);if((t.x>1||r&&this.collidingFromRight(t,r)||p)&&t.x--,a&&this.colliding(t,a)&&(t.color=a.color,this.unregisterSprite("key"),this.setGlobals("hasKey",!0),this.unregisterSprite("enemy"+(this.screenWidth-2))),p&&t.x<0)for(var d in this.getSprites())this.unregisterSprite(d);break;case 39:case 68:if(l&&this.collidingFromLeft(t,l))return y&&(t.x<this.screenWidth-2||o&&this.collidingFromLeft(t,o)||p)?(t.x++,void(this.colliding(t,l)&&(l.x++,this.setGlobals("hasBlock",!1),this.colliding(l,o)&&(n.mapCoords.x++,n.blockCoords.x=2,this.unregisterSprite("block"))))):void(Me.left||Me.left++);if((t.x<this.screenWidth-2||o&&this.collidingFromLeft(t,o)||p)&&t.x++,p&&t.x>this.screenWidth-1)for(var d in this.getSprites())this.unregisterSprite(d);break;case 32:this.isPaused()?this.unpause():this.pause()}if(-1!==[37,38,39,40,65,68,83,87].indexOf(e.keyCode)){var u=this.getSprites(/enemy/);for(var f in u)l&&this.colliding(l,u[f])&&(this.unregisterSprite(f),this.unregisterSprite("block"),this.setGlobals("blockCoords",{blockCoords:{x:-1,y:-1},mapCoords:{x:-1,y:-1}})),this.colliding(t,u[f])&&!this.flashEndingPosition&&this.flashEnding(3,150,h)}},d.Dungeon.onkeyup=function(e){switch(e.keyCode){case 38:case 87:Me.bottom=0;break;case 40:case 83:Me.top=0;break;case 37:case 65:Me.right=0;break;case 39:case 68:Me.left=0}},d.Dungeon.delay=50,d.Dungeon.update=function(e){var t=this.getSprites("topDoor"),i=this.getSprites("leftDoor"),o=this.getSprites("rightDoor"),s=this.getSprites("bottomDoor"),r=this.getGlobals("roomCoords"),l=this.getSprites("player"),a=this.getGlobals("roomTimeCount"),c=this.getSprites(/enemy/),g=this.getSprites("block"),y=this.getGlobals("hasKey"),p=!1;if(e||(a++,this.setGlobals("roomTimeCount",a)),t&&this.colliding(l,t)?(r.y--,r.y<0&&2===r.x&&(r.x=4,r.y=2),l.y=this.screenHeight-2,p=!0):i&&this.colliding(l,i)?(r.x--,l.x=this.screenWidth-2,p=!0):o&&this.colliding(l,o)?(r.x++,l.x=1,p=!0):s&&this.colliding(l,s)&&(r.y++,l.y=1,p=!0),p)return this.setGlobals("roomTimeCount",0),this.setGlobals("roomCoords",r),void n.call(this,r);if(1===r.x&&2===r.y){var d=this.screenHeight-3,u=Math.floor((a-1)/d),f=this.getSprites("enemy"+(u+1));f&&this.getSprites("enemy"+(u+1)).y++}else if(2===r.x&&3===r.y)if(y){if(a%10===5){var m=this.getSprites("enemy0");m.x<l.x?m.x++:m.x>l.x&&m.x--}else if(a%10===9){var m=this.getSprites("enemy0");m.y<l.y?m.y++:m.y>l.y&&m.y--}}else a%20===10?this.getSprites("enemy0").y++:a%20===19&&this.getSprites("enemy0").y--;else if(4===r.x&&3===r.y&&a%30===29){var m=this.getSprites("enemy0");m.x-1>0&&(m.x--,m.width++),m.x+m.width+1<this.screenWidth&&m.width++,m.y-1>0&&(m.y--,m.height++),m.y+m.height+1<this.screenHeight&&m.height++}else if(0===r.x&&0===r.y&&a%2===1){var v=Math.min(this.screenWidth-2,this.screenHeight-2),x=Math.floor(a/2)%v,m=this.getSprites("enemy0");m.x=this.screenWidth-1-v+x,m.y=this.screenHeight-1-v+x}else if(2===r.x&&1===r.y){var m=this.getSprites("enemy0"),b=this.getSprites("enemy1");10>a%40?(m.x=2,m.y=3,b.x=this.screenWidth-3,b.y=this.screenHeight-2):20>a%40?(m.x=Math.floor(this.screenWidth/2)-1,m.y=Math.floor(this.screenHeight/2)+1,b.x=Math.floor(this.screenWidth/2)-2,b.y=Math.floor(this.screenHeight/2)-1):30>a%40?(m.x=1,m.y=1,b.x=this.screenWidth-2,b.y=this.screenHeight-2):(m.x=Math.floor(this.screenWidth/3)-1,m.y=2*Math.floor(this.screenHeight/2)-1,b.x=this.screenWidth-2,b.y=Math.floor(this.screenHeight/2)-1),a%10>6&&(m.x=-1,m.y=-1,b.x=-1,b.y=-1)}else if(3===r.x&&1===r.y){var m=this.getSprites("enemy0"),b=this.getSprites("enemy1"),x=a%(2*(this.screenWidth-2));x<this.screenWidth-2?(m.x=this.screenWidth-1-(1+x),b.x=1+x):(x%=this.screenWidth-2,m.x=1+x,b.x=this.screenWidth-1-(1+x))}else if(1===r.x&&1===r.y){var m=this.getSprites("enemy0"),S=m.polygon[m.polygon.length-1],w=(this.screenWidth-2,this.screenWidth-2),k=this.screenHeight-2;if(m.polygon.length>=(this.screenWidth-2)*(this.screenHeight-2))return;S.y%2===1?1===S.x&&2===m.polygon[m.polygon.length-2].x?(w=1,k=S.y-1):(w=S.x-1,k=S.y):S.x===this.screenWidth-2&&m.polygon[m.polygon.length-2].x===this.screenWidth-3?(w=this.screenWidth-2,k=S.y-1):(w=S.x+1,k=S.y),m.polygon.push({x:w,y:k,width:1,height:1,color:Ce})}else if(4===r.x&&1===r.y){var C=this.getSprites("enemy0"),W=C.polygon.length,M=!1,G=(this.screenWidth-2)*(this.screenHeight-2),H=2*(G-W),P=Math.floor(H/2);for(a===H&&this.setGlobals("roomTimeCount",this.screenWidth-1-C.polygon.length),a%H>P&&(M=!0);W-->1;)C.polygon[W].x=C.polygon[W-1].x,C.polygon[W].y=C.polygon[W-1].y;C.velocityX>0?C.polygon[0].x+C.velocityX<this.screenWidth-1?C.polygon[0].x+=C.velocityX:(C.velocityX*=-1,M&&C.polygon[0].y>1?C.polygon[0].y--:C.polygon[0].y<this.screenHeight-2&&C.polygon[0].y++):C.polygon[0].x+C.velocityX>0?C.polygon[0].x+=C.velocityX:(C.velocityX*=-1,M&&C.polygon[0].y>1?C.polygon[0].y--:C.polygon[0].y<this.screenHeight-2&&C.polygon[0].y++)}var c=this.getSprites(/enemy/);for(var T in c)g&&this.colliding(g,c[T])&&(this.unregisterSprite(T),this.unregisterSprite("block"),this.setGlobals("blockCoords",{blockCoords:{x:-1,y:-1},mapCoords:{x:-1,y:-1}})),this.colliding(l,c[T])&&!this.flashEndingPosition&&this.flashEnding(3,150,h);if(y)for(var X in Me)Me[X]&&(Me[X]++,Me[X]>=60&&(Me[X]=0,this.registerGlobals("hasBlock",!0)))},he.prototype.addGamesList=function(t){var t=t||{},i=document.createElement("select"),o=document.createElement("option"),s=document.createTextNode("- Select - "),r=this;t&&Object.keys(t).length||(t=d),o.appendChild(s),o.value="0",i.appendChild(o);for(var l in t)o=document.createElement("option"),s=document.createTextNode(l),o.appendChild(s),o.value=l,i.appendChild(o);return i.onchange=function(e){r.pause(),"0"!==this.value&&(I=new he(t[this.value]),this.parentNode.removeChild(this))},i.style.marginLeft=r.table.style.marginLeft||(e.getComputedStyle?e.getComputedStyle(r.table).getPropertyValue("margin-left"):""),r.table.parentNode.insertBefore(i,r.table.nextSibling),this},he.closestTable=function(e){for(;e&&"TABLE"!==e.nodeName;)e=e.parentNode;return e},he.clickToChoose=function(){document.getElementsByTagName("table");le(e,"click",Ge,!1)};var Ge=function(t){if(!re){var i=new he({table:he.closestTable(t.target)});i.addGamesList(),re=!0,ne(e,"click",Ge,!1)}};return he}(window);