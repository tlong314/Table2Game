var Table2Game=function(e,t){function i(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(0===t.y)return!1;if(this.collidingFromBelow(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromBelow(t,e[o]))return!1;return!0}function o(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(t.y===this.screenHeight-1)return!1;if(this.collidingFromAbove(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromAbove(t,e[o]))return!1;return!0}function r(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(0===t.x)return!1;if(this.collidingFromRight(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromRight(t,e[o]))return!1;return!0}function s(){var e=this.getSprites(),t=this.getSprites("player"),i=this.getSprites("goal");if(t.x===this.screenWidth-1)return!1;if(this.collidingFromLeft(t,i))return!0;for(var o in e)if(e[o]!==t&&this.collidingFromLeft(t,e[o]))return!1;return!0}function l(e,t){var i=Object.keys(t.getSprites(/playerBullet/)||{}).length;this.x=e.x,this.y=e.y,this.velocityX=e.velocityX,this.velocityY=e.velocityY,this.width=e.width||1,this.height=e.height||1,this.name=e.name||"playerBullet"+i,t.registerSprite(this.name,{x:e.x,y:e.y,velocityX:e.velocityX,velocityY:e.velocityY,width:e.width||1,height:e.height||1});var o=this;this.moveY=function(){if(o.y>=0&&o.velocityY<0){var e=t.getSprites(o.name)||{};o.y+=o.velocityY,e.y=o.y,setTimeout(o.moveY,t.delay)}else t.unregisterSprite(o.name)}}function h(e){switch(c.call(this),e.y){case 0:switch(e.x){case 0:a.call(this,"bottom","right"),this.registerSprite("enemy0",{x:1,y:1,color:Ce});break;case 1:a.call(this,"bottom","left","right");for(var t=this.getGlobals("hasKey"),i=this.screenWidth-(t?3:2),o=1;i>=o;o++)this.registerSprite("enemy"+o,{x:o,y:this.screenHeight-3,width:1,height:1,color:Ce});t||this.registerSprite("key",{x:1,y:this.screenHeight-2,color:this.yellow});break;case 2:a.call(this,"bottom","left","right");var r=this.getGlobals("doorCoords");this.registerSprite("topDoor",{x:r.top.x,y:r.top.y,width:1,height:1,color:this.defaultColor});for(var o=1;o<=this.screenWidth-2;o++)this.registerSprite("enemy"+o,{x:o,y:2,width:1,height:1,color:Ce});break;case 3:a.call(this,"bottom","left");break;case 4:a.call(this,"bottom","top"),this.registerSprite("block",{x:1,y:2,width:this.screenWidth-2,color:We}),this.registerSprite("keyhole",{x:Math.floor(this.screenWidth/2),y:2,color:this.yellow}),this.registerSprite("gameWinningDoor",{x:Math.floor(this.screenWidth/2),y:0,color:this.green}),this.registerSprite("enemy0",{x:1,y:1,width:Math.floor(this.screenWidth/2)-2,color:Ce}),this.registerSprite("enemy1",{x:Math.floor(gt.screenWidth/2)+2,y:1,width:gt.screenWidth-Math.floor(gt.screenWidth/2)-3,color:Ce})}break;case 1:switch(e.x){case 0:a.call(this,"top","bottom"),this.registerSprite("enemy0",{x:2,y:2,color:Ce}).registerSprite("enemy1",{x:this.screenWidth-3,y:this.screenHeight-3,color:Ce});break;case 1:a.call(this,"top","right"),this.registerSprite("enemy0",{polygon:[{x:this.screenWidth-2,y:this.screenHeight-2,width:1,height:1,color:Ce}]});break;case 2:a.call(this,"top","left"),this.registerSprite("enemy0",{x:2,y:2,color:Ce}).registerSprite("enemy1",{x:2,y:2,color:Ce});break;case 3:a.call(this,"top","bottom"),this.registerSprite("enemy0",{x:this.screenWidth-2,y:2,color:Ce}).registerSprite("enemy1",{x:1,y:this.screenHeight-3,color:Ce});break;case 4:a.call(this,"top","bottom");var s=this.getSprites("player");if(1===s.y){this.registerSprite("enemy0",{velocityX:-1,x:-1,y:-1,polygon:[{x:this.screenWidth-2,y:this.screenHeight-2,width:1,height:1,color:Ce}]});var l=this.getSprites("enemy0"),h=Math.floor((this.screenWidth-2)/2);this.setGlobal("roomTimeCount",(this.screenWidth-2)*(this.screenHeight-2));for(var o=2;h>=o;o++)l.polygon.push({x:this.screenWidth-o,y:this.screenHeight-2,width:1,height:1,color:Ce});l.polygon.reverse()}else{this.registerSprite("enemy0",{velocityX:1,x:-1,y:-1,polygon:[{x:1,y:1,width:1,height:1,color:Ce}]});for(var l=this.getSprites("enemy0"),h=Math.floor((this.screenWidth-2)/2),o=2;h>=o;o++)l.polygon.push({x:o,y:1,width:1,height:1,color:Ce});l.polygon.reverse()}}break;case 2:switch(e.x){case 0:a.call(this,"bottom","top","right");for(var n=Math.min(this.screenWidth,this.screenHeight)-2,y=n;n>1;)this.registerSprite("enemy"+n,{x:this.screenWidth-2-y+n,y:this.screenHeight-1-n,color:Ce}),n--;break;case 1:a.call(this,"bottom","left","right");for(var o=1;o<this.screenWidth-1;o++)this.registerSprite("enemy"+o,{x:o,y:1,color:Ce});break;case 2:a.call(this,"left","right"),this.registerSprite("enemy0",{x:2,y:2,width:this.screenWidth-4,height:this.screenHeight-4,color:Ce});break;case 3:a.call(this,"top","left"),this.registerSprite("enemy0",{x:1,y:2,width:1+Math.floor(this.screenWidth/2),color:Ce}).registerSprite("enemy1",{x:2+Math.floor(this.screenWidth/2),y:2,width:1,height:this.screenHeight-4,color:Ce}).registerSprite("enemy2",{x:2,y:this.screenHeight-3,width:Math.floor(this.screenWidth/2),color:Ce});break;case 4:a.call(this,"bottom","top");var d=2;for(this.registerSprite("enemy"+d,{x:Math.floor(this.screenWidth/2),y:d,color:Ce});d++<this.screenHeight-3;)this.registerSprite("enemy"+d,{x:Math.floor(this.screenWidth/2)-(d-2),y:d,color:Ce}).registerSprite("enemy"+d+"B",{x:Math.floor(this.screenWidth/2)+(d-2),y:d,color:Ce})}break;case 3:switch(e.x){case 0:a.call(this,"top","right"),this.registerSprite("enemy0",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),color:Ce});break;case 1:a.call(this,"top","left","right");break;case 2:a.call(this,"left","right"),this.registerSprite("enemy0",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),color:Ce});break;case 3:a.call(this,"left","right");for(var n=Math.min(this.screenWidth,this.screenHeight)-2,y=n;n>1;)this.registerSprite("enemy"+n,{x:1+y-n,y:n,color:Ce}),n--;break;case 4:a.call(this,"left","top"),this.registerSprite("enemy0",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),color:Ce})}break;default:4===e.x&&g.call(this)}var p=this.getGlobals("blockCoords");p.mapCoords.x===e.x&&p.mapCoords.y===e.y&&this.registerSprite("block",p.blockCoords),this.moveToTop("player")}function n(){var e=this.getSprites("player");this.flashEndingPosition=0,this.setGlobal("hasKey",!1),this.setGlobal("hasBlock",!1),this.setGlobal("gameOver",!1),this.setGlobal("roomTimeCount",0),this.setGlobal("roomCoords",{x:1,y:3}),this.setGlobal("blockCoords",{blockCoords:{x:Math.floor(this.screenWidth/2),y:3,color:We},mapCoords:{x:3,y:0}}),Ge={top:0,bottom:0,left:0,right:0},e.x=Math.floor(this.screenWidth/2),e.y=Math.ceil(this.screenHeight/2),e.color=this.getGlobals("startingColor"),h.call(this,{x:1,y:3})}function a(){for(var e=this.getGlobals("doorCoords"),t=0,i=arguments.length;i>t;t++)this.registerSprite(arguments[t]+"Door",{x:e[arguments[t]].x,y:e[arguments[t]].y,width:1,height:1,color:ke})}function c(){var e=this.getSprites();for(var t in e)/Wall/i.test(t)||"player"===t||this.unregisterSprite(t)}function g(){var e=this,t=3,i=150;totalFlashTime=(2*t-1)*i,player=this.getSprites("player"),player.y=e.screenHeight-2,e.flashEnding(t),setTimeout(function(){e.unregisterSprite("leftWall")},totalFlashTime),setTimeout(function(){e.unregisterSprite("rightWall")},totalFlashTime+1e3),setTimeout(function(){e.unregisterSprite("topWall")},totalFlashTime+2e3),setTimeout(function(){e.unregisterSprite("bottomWall")},totalFlashTime+3e3),setTimeout(function(){e.registerSprite("sky",{x:0,y:0,width:e.screenWidth,height:e.screenHeight,color:e.blue}).registerSprite("grass",{x:0,y:e.screenHeight-1,width:e.screenWidth,height:1,color:e.green}).registerSprite("sun",{x:e.screenWidth-2,y:0,width:2,height:2,color:e.yellow}),e.setGlobal("gameOver",!0),player.x=Math.floor(e.screenWidth/2),player.y=e.screenHeight-2,e.moveToTop("player")},totalFlashTime+4e3)}Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=i.length;return function(r){if("function"!=typeof r&&("object"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var s,l,h=[];for(s in r)e.call(r,s)&&h.push(s);if(t)for(l=0;o>l;l++)e.call(r,i[l])&&h.push(i[l]);return h}}());var y=t,d=t,p={"Ping Pong":{},Snake:{},"Break Bricks":{},"Whack-a-mole":{},Maze:{},"Creepy Crawler":{},Jumper:{},Paint:{},Sniper:{},Dungeon:{}},u=[],f={},m={},v=t,x=0,b=!1,S=function(){},w=50,k=function(){},C=function(){},W=!0,G=function(){},M=1,H=1,P=0,T=0,X="#ffffff",Y="#f1f1f1",D="#d1d1d1",E="#fff1f1",F="#f1fff1",B="#f1f1ff",L="#fffff1",O="#f1ffff",R="#fff1ff",I="#eee",A=null,N=null,j=null,_=null,J=null,K=null,q=null,z=null,V=null,Q=null,U=null,Z=null,$=null,ee=null,te=null,ie=null,oe=null,re={onkeydown:!1,onkeyup:!1,onkeypress:!1,onclick:!1,onmousedown:!1,onmouseup:!1,onmousemove:!1,onmouseenter:!1,onmouseleave:!1,onmouseover:!1,onmouseout:!1,onmousewheel:!1,oncontextmenu:!1,touchstart:!1,touchmove:!1,touchend:!1},se=!1,le=function(t,i,o,r){return e.attachEvent?t.attachEvent(i,o):t.addEventListener(i,o,r)},he=function(t,i,o,r){return e.detachEvent?t.detachEvent(i,o):t.removeEventListener(i,o,r)},ne=function(i,o){if(this===e)return new ne(i);if(i=i||{},"string"==typeof i){if("undefined"!=typeof o){for(var r in o)p[i][r]=o[r];return new ne(p[i],o)}return new ne(p[i])}var s={table:document.querySelector?document.querySelector("table"):document.getElementsByTagName("table")[0],globals:{},sprites:{},details:{},delay:50,init:function(){},update:function(){},onpause:function(){},onunpause:function(){},onpaint:function(){}},l=[],h=1,n=1,a=null;y=t,d=t,u=[],m={},x=0,b=!1,runningTime=0,T=0,tableExists=!1,M=1,H=1,v&&clearInterval(v),i=i||{};for(var c in s)i[c]=i[c]||s[c];y=this,d="string"==typeof i.table?document.getElementById(i.table.replace("#","")):i.table.jquery?i.table[0]:i.table,y.table=d;for(var g in i.globals)y.registerGlobal(g,i.globals[g]);for(var f in i.sprites)y.registerSprite(f,i.sprites[f]);a=document.createElement("div"),a.id="Table2GameDetailsDiv",a.style.display="inline block",a.color="#eee",a.innerHTML="";for(var P in i.details)a.innerHTML+=P+": <span id='Table2Game"+P+"Span' class='Table2GameDetail' style='margin-right: 10px;'>"+i.details[P]+"</span>";a.style.marginLeft=y.table.style.marginLeft||(e.getComputedStyle?e.getComputedStyle(y.table).getPropertyValue("margin-left"):""),d.parentNode.insertBefore(a,d.nextSibling),y.detailsDiv=a,y.details=i.details,i.onkeydown?N?N=i.onkeydown:(N=i.onkeydown,le(e,"keydown",function(e){N.call(y,e)},!1),re.onkeydown=!0):re.onkeydown&&(N=function(){},re.onkeydown=!1),i.onkeyup?j?j=i.onkeyup:(j=i.onkeyup,le(e,"keyup",function(e){j.call(y,e)},!1),re.onkeyup=!0):re.onkeyup&&(j=function(){},re.onkeyup=!1),i.onkeypress?_?_=i.onkeypress:(_=i.onkeypress,le(e,"keypress",function(e){_.call(y,e)},!1),re.onkeypress=!0):re.onkeypress&&(_=function(){},re.onkeypress=!1),i.onclick?(J?J=i.onclick:(J=i.onclick,le(y.table,"click",function(e){J.call(y,e)},!1),re.onclick=!0),d.style.cursor="default"):re.onclick&&(J=function(){},re.onclick=!1),i.onmousedown?(K?K=i.onmousedown:(K=i.onmousedown,le(y.table,"mousedown",function(e){K.call(y,e)},!1),re.onmousedown=!0),d.style.cursor="default"):re.onmousedown&&(K=function(){},re.onmousedown=!1),i.onmouseup?(q?q=i.onmouseup:(q=i.onmouseup,le(y.table,"mouseup",function(e){q.call(y,e)},!1),re.onmouseup=!0),d.style.cursor="default"):re.onmouseup&&(q=function(){},re.onmouseup=!1),i.onmousemove?(z?z=i.onmousemove:(z=i.onmousemove,le(y.table,"mousemove",function(e){z.call(y,e)},!1),re.onmousemove=!0),d.style.cursor="default"):re.onmousemove&&(z=function(){},re.onmousemove=!1),i.onmouseenter?(V?V=i.onmouseenter:(V=i.onmouseenter,le(y.table,"mouseenter",function(e){V.call(y,e)},!1),re.onmouseenter=!0),d.style.cursor="default"):re.onmouseenter&&(V=function(){},re.onmouseenter=!1),i.onmouseleave?(Q?Q=i.onmouseleave:(Q=i.onmouseleave,le(y.table,"mouseleave",function(e){Q.call(y,e)},!1),re.onmouseleave=!0),d.style.cursor="default"):re.onmouseleave&&(Q=function(){},re.onmouseleave=!1),i.onmouseover?(U?U=i.onmouseover:(U=i.onmouseover,le(y.table,"mouseover",function(e){U.call(y,e)},!1),re.onmouseover=!0),d.style.cursor="default"):re.onmouseover&&(U=function(){},re.onmouseover=!1),i.onmouseout?(Z?Z=i.onmouseout:(Z=i.onmouseout,le(y.table,"mouseout",function(e){Z.call(y,e)},!1),re.onmouseout=!0),d.style.cursor="default"):re.onmouseout&&(Z=function(){},re.onmouseout=!1),i.onmousewheel?($?$=i.onmousewheel:($=i.onmousewheel,le(y.table,"mousewheel",function(e){$.call(y,e)},!1),re.onmousewheel=!0),d.style.cursor="default"):re.onmousewheel&&($=function(){},re.onmousewheel=!1),i.oncontextmenu?(ee?ee=i.oncontextmenu:(ee=i.oncontextmenu,le(y.table,"contextmenu",function(e){ee.call(y,e)},!1),re.oncontextmenu=!0),d.style.cursor="default"):re.oncontextmenu&&(ee=function(){},re.oncontextmenu=!1),i.ontouchstart?te?te=i.ontouchstart:(te=i.ontouchstart,le(y.table,"touchstart",function(e){te.call(y,e)},!1),re.ontouchstart=!0):re.ontouchstart&&(te=function(){},re.ontouchstart=!1),i.ontouchmove?ie?ie=i.ontouchmove:(ie=i.ontouchmove,le(y.table,"touchmove",function(e){ie.call(y,e)},!1),re.ontouchmove=!0):re.ontouchmove&&(ie=function(){},re.ontouchmove=!1),i.ontouchend?oe?oe=i.ontouchend:(oe=i.ontouchend,le(y.table,"touchend",function(e){oe.call(y,e)},!1),re.ontouchend=!0):re.ontouchend&&(oe=function(){},re.ontouchend=!1),w=i.delay||w,y.delay=w,y.flashEndingPosition=0,y.defaultColor=i.defaultColor||i.gray||I,y.white=i.white||X,y.black=i.black||D,y.gray=i.gray||Y,y.red=i.red||E,y.green=i.green||F,y.blue=i.blue||B,y.yellow=i.yellow||L,y.purple=i.purple||R,y.blueGreen=i.blueGreen||O,W=i.hideOnPause||W,l=d.rows,h=l[0].length,n=l.length;var A=0,se=0;e:for(var he=0,ce=l.length;ce>he;he++){for(var ge=[],ye=0,de=l[he].cells.length;de>ye;ye++){if(l[he].cells[ye].getAttribute("colspan")&&parseInt(l[he].cells[ye].getAttribute("colspan"),10)>1)continue e;ge.push(l[he].cells[ye]),l[he].cells[ye].style.background="transparent"}u.push(ge),A++,se=Math.max(se,l[he].cells.length)}return H=y.screenHeight=A,M=y.screenWidth=se,S=i.update,k=i.onpause,C=i.onunpause,G=i.onpaint,i.init.call(y),y.paint(),setTimeout(function(){v=setInterval(ae,w)},i.initialDelay||20),y};ne.prototype.constructor=ne,ne.defaultColor=I,ne.black=D,ne.gray=Y,ne.red=E,ne.green=F,ne.blue=B,ne.yellow=L,ne.purple=R,ne.blueGreen=O;var ae=function(){b||P||(x++,S.call(y),y.paint())};ne.prototype.setTimeout=function(t,i){return P=i,e.setTimeout(function(){P=0,t.call(y)},i),this},ne.prototype.getDelay=function(){return w},ne.prototype.setDelay=function(e){return clearInterval(v),w=e,v=setInterval(ae,w),this};var ce=function(e){var i={name:t,x:0,y:0,velocityX:0,velocityY:0,width:1,height:1,color:I,polygon:[]},o=this;for(var r in i)o[r]=e[r]||i[r];0===e.width&&(o.width=0),0===e.height&&(o.height=0),o.shiftPolygons=function(e,t,i){if(i)if("function"==typeof t)for(var r=0,s=o.polygon.length;s>r;r++)o.polygon[r][e]=t.call(o,o.polygon[r][e]);else for(var r=0,s=o.polygon.length;s>r;r++)o.polygon[r][e]=t;else if("function"==typeof t)for(var r=0,s=o.polygon.length;s>r;r++)o.polygon[r][e]+=t.call(o,o.polygon[r][e]);else for(var r=0,s=o.polygon.length;s>r;r++)o.polygon[r][e]+=t}};ne.prototype.registerSprite=function(e,t){return t=t||{},t.name=e,m[e]=new ce(t),this},ne.prototype.unregisterSprite=function(e){return"string"==typeof e?delete m[e]:delete m[e.name],this},ne.prototype.getSprites=function(e){var t={};if(e){if(e instanceof RegExp){for(var i in m)e.test(i)&&(t[i]=m[i]);return t}return m[e]}return m},ne.prototype.registerGlobal=function(e,t){return f[e]=t,this},ne.prototype.unregisterGlobal=function(e){delete f[e]},ne.prototype.getGlobals=function(e){var t={};if(e){if(e instanceof RegExp){for(var i in f)e.test(i)&&(t[i]=f[i]);return t}return f[e]}return f},ne.prototype.setGlobal=function(e,t){return f[e]=t,this},ne.prototype.getTable=function(){return d},ne.prototype.getTableArr=function(){return u},ne.prototype.getCell=function(e,t){return 0>e||0>t||e>M||t>H?{style:{color:"",backgroundColor:""}}:u[t][e]},ne.prototype.colliding=function(e,t,i,o,r,s,l,h){if("object"==typeof e){var n=e,a=t;return a?n.polygon&&n.polygon.length||a.polygon&&a.polygon.length?this.collidingPolygons(n,a):this.colliding(n.x,n.y,n.width,n.height,a.x,a.y,a.width,a.height):!1}return r+l>e&&e+i>r&&s+h>t&&t+o>s?!0:!1},ne.prototype.collidingPolygons=function(e,t){if(!(e.polygon&&e.polygon.length||t.polygon&&t.polygon.length))return this.collidingPolygons({polygon:[{x:e.x,y:e.y,width:e.width,height:e.height}]},{polygon:[{x:t.x,y:t.y,width:t.width,height:t.height}]});if(!e.polygon||!e.polygon.length)return this.collidingPolygons({polygon:[{x:e.x,y:e.y,width:e.width,height:e.height}]},t);if(!t.polygon||!t.polygon.length)return this.collidingPolygons(e,{polygon:[{x:t.x,y:t.y,width:t.width,height:t.height}]});for(var i="",o=0,r=e.polygon.length;r>o;o++)i+="_"+e.polygon[o].x+"&"+e.polygon[o].y+"_";for(var o=0,r=t.polygon.length;r>o;o++)if(~i.indexOf("_"+t.polygon[o].x+"&"+t.polygon[o].y+"_"))return!0;return!1},ne.prototype.collidingFromLeft=function(e,t){return 0!==e.velocityX?this.colliding(e.x+Math.abs(e.velocityX),e.y,e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x+1,e.y,e.width,e.height,t.x,t.y,t.width,t.height)},ne.prototype.collidingFromRight=function(e,t){return 0!==e.velocityX?this.colliding(e.x-Math.abs(e.velocityX),e.y,e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x-1,e.y,e.width,e.height,t.x,t.y,t.width,t.height)},ne.prototype.collidingFromAbove=function(e,t){return 0!==e.velocityY?this.colliding(e.x,e.y+Math.abs(e.velocityY),e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x,e.y+1,e.width,e.height,t.x,t.y,t.width,t.height)},ne.prototype.collidingFromBelow=function(e,t){return 0!==e.velocityY?this.colliding(e.x,e.y-Math.abs(e.velocityY),e.width,e.height,t.x,t.y,t.width,t.height):this.colliding(e.x,e.y-1,e.width,e.height,t.x,t.y,t.width,t.height)},ne.prototype.touching=function(e,t,i){if(Math.abs(e.x-t.x)>1||Math.abs(e.y-t.y)>1)return!1;if(i){var o={x:t.x-1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0},r={x:t.x+1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0},s={x:t.x-1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0},l={x:t.x+1,y:t.y,width:t.width,height:t.height,velocityX:0,velocityY:0};return this.collidingFromAbove(e,t)||this.collidingFromBelow(e,t)||this.collidingFromLeft(e,t)||this.collidingFromRight(e,t)||this.collidingFromBelow(e,o)||this.collidingFromBelow(e,r)||this.collidingFromAbove(e,s)||this.collidingFromAbove(e,l)}return this.collidingFromAbove(e,t)||this.collidingFromBelow(e,t)||this.collidingFromLeft(e,t)||this.collidingFromRight(e,t)},ne.prototype.clear=function(){for(var e=0;e<u.length;e++)for(var t=0;t<u[e].length;t++)u[e][t].style.background="transparent";return this},ne.prototype.fillRect=function(e,t,i,o,r){if(r=r||I,0===i)for(var s=t,l=Math.min(t+o,H);l>s;s++)for(var h=e,n=Math.min(e+i,M);n>h;h++)this.getCell(h,s).style["border-left"]="1px solid "+r;else if(0===o)for(var s=t,l=Math.min(t+o,H);l>s;s++)for(var h=e,n=Math.min(e+i,M);n>h;h++)this.getCell(h,s).style["border-top"]="1px solid "+r;else for(var s=t,l=Math.min(t+o,H);l>s;s++)for(var h=e,n=Math.min(e+i,M);n>h;h++)this.getCell(h,s).style.backgroundColor=r;return this},ne.prototype.fillPolygon=function(e,t){for(var i=0,o=e.length;o>i;i++)this.fillRect(e[i].x,e[i].y,e[i].width,e[i].height,e[i].color||t);return this},ne.prototype.paint=function(){if(this.clear(),!b||!W)for(var e in m)m[e].polygon.length?this.fillPolygon(m[e].polygon,m[e].color):this.fillRect(m[e].x,m[e].y,m[e].width,m[e].height,m[e].color);return this.onpaint(),this},ne.prototype.pause=function(){return W&&(this.clear(),this.detailsDiv.style.display="none"),this.onpause(),b=!0,clearInterval(v),this},ne.prototype.unpause=function(){return this.onunpause(),b=!1,(this.detailsDiv.style.display="none")&&(this.detailsDiv.style.display="inline block"),v=setInterval(ae,w),this},ne.prototype.isPaused=function(){return b},ne.prototype.onpause=function(){k.call(this)},ne.prototype.onunpause=function(){C.call(this)},ne.prototype.onpaint=function(){G.call(this)},ne.prototype.getDetails=function(e){if("undefined"==typeof e){var t={};for(var i in details)t[i]=this.details[i];return t}return this.details[e]},ne.prototype.setDetails=function(e,t){if("object"==typeof e)for(var i in e)this.details[i]=e[i],document.getElementById("Table2Game"+i+"Span").innerHTML=e[i];else this.details[e]=t,document.getElementById("Table2Game"+e+"Span").innerHTML=t;return this},ne.prototype.getDetailsElement=function(e){return e?document.getElementById("Table2Game"+e+"Span").innerHTML:this.detailsDiv},ne.prototype.closestCell=function(e){var t="",i=e;if(!i)return null;if("TD"===i.nodeName||"TH"===i.nodeName)return i;for(;i.parentNode&&"TD"!==t&&"TH"!==t&&"TABLE"!==t;){try{i=i.parentNode,nameName=i.nodeName}catch(o){break}}return"TD"===t||"TH"===t?i:null},ne.prototype.cellCoordinates=function(e){for(var t=this.getTableArr(),i=0;i<t.length;i++)if(-1!==t[i].indexOf(e))return{x:t[i].indexOf(e),y:i};return-1},ne.prototype.moveToTop=function(e){var t=this.getSprites(e),i={};for(var o in t)"object"==typeof o&&"undefined"!=typeof JSON?i[o]=JSON.parse(JSON.stringify(t[o])):i[o]=t[o];return this.unregisterSprite(e).registerSprite(e,i)},ne.prototype.flashEnding=function(e,t,i){var t=t||150,e=e||5,o=this,r=(2*e-1)*t;if(!o.flashEndingPosition){for(var s=0;2*e>s;s+=2)setTimeout(function(){o.pause()},t*s),setTimeout(function(){o.unpause(),o.paint()},t*(s+1));this.flashEndingPosition=1}setTimeout(function(){o.flashEndingPosition=2,i&&i.call(o)},r)},p["Ping Pong"].init=function(){this.registerSprite("leftPaddle",{x:0,y:2,width:1,height:3,velocityX:0,velocityY:0,color:this.defaultColor}),this.registerSprite("rightPaddle",{x:this.screenWidth-1,y:2,width:1,height:3,velocityX:0,velocityY:0,color:this.defaultColor}),this.registerSprite("ball",{x:3,y:2,velocityX:1,velocityY:1})},p["Ping Pong"].details={Score:0,Lives:3},p["Ping Pong"].update=function(){var e=this.getSprites("ball"),t=this.getSprites("leftPaddle"),i=this.getSprites("rightPaddle"),o=this;if(e){if(e.velocityX>0)if(this.collidingFromLeft(e,i))e.velocityX*=-1,e.x+=e.velocityX;else if(e.x+e.velocityX<=this.screenWidth)e.x+=e.velocityX;else{if(e.color="#ffdddd",e.velocityX*=-1,o.setDetails("Lives",o.getDetails("Lives")-1),0===o.getDetails("Lives"))return o.unregisterSprite("ball"),void o.flashEnding();o.setTimeout(function(){e.x=Math.ceil(o.screenWidth/2),o.paint(),o.setTimeout(function(){e.color="#eee"},500)},500)}else if(e.velocityX<0)if(this.collidingFromRight(e,t))e.velocityX*=-1,e.x+=e.velocityX;else if(e.x>=0)e.x+=e.velocityX;else{if(e.color="#ddffdd",e.velocityX*=-1,o.setDetails("Score",o.getDetails("Score")+100),o.getDetails("Score")>=1e3)return o.unregisterSprite("ball"),void o.flashEnding(3,300);o.setTimeout(function(){e.x=Math.floor(o.screenWidth/2),o.paint(),o.setTimeout(function(){e.color="#eee"},500)},500)}e.velocityY>0?e.y+e.velocityY<this.screenHeight?e.y+=e.velocityY:(e.velocityY*=-1,e.y+=e.velocityY):e.velocityY<0&&(e.y>0?e.y+=e.velocityY:(e.velocityY*=-1,e.y+=e.velocityY)),updateAIPaddle.call(o,e,t)}},updateAIPaddle=function(e,t){10*Math.random()<5||(t.y+1<e.y?t.y+t.height<this.screenHeight&&t.y++:t.y>0&&t.y--)},p["Ping Pong"].delay=100,p["Ping Pong"].onkeydown=function(e){var t=this.getSprites("rightPaddle");switch(e.keyCode){case 38:case 87:t.y>0&&t.y--;break;case 40:case 83:t.y+t.height<this.screenHeight&&t.y++;break;case 32:this.isPaused()?this.unpause():this.pause()}this.paint()},p.Snake.init=function(){this.registerSprite("snake",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),width:1,height:1,velocityX:1,velocityY:0,polygon:[{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),width:1,height:1}]}),this.registerGlobal("timeCount",0)},p.Snake.details={Score:0,Lives:3};var ge=function(e){for(var t=!0,i=0,o=0,r=0;t&&100>r;)i=Math.floor(Math.random()*this.screenWidth),o=Math.floor(Math.random()*this.screenHeight),this.colliding({polygon:e},{polygon:[{x:i,y:o,width:1,height:1}]})||(i!==Math.floor(this.screenWidth/2)||o!==Math.floor(this.screenHeight/2))&&(t=!1),r++;this.registerSprite("block"+Object.keys(this.getSprites()).length,{x:i,y:o,width:1,height:1,color:"#ddd"})};p.Snake.update=function(){var e=this.getSprites("snake");if(e){var t=e.polygon[e.polygon.length-1].x,i=e.polygon[e.polygon.length-1].y,o=0;this.setGlobal("timeCount",this.getGlobals("timeCount")+1),this.getGlobals("timeCount")%15===14&&Object.keys(this.getSprites()).length<2&&ge.call(this,e.polygon);for(var o=e.polygon.length;o-->1;)e.polygon[o].x=e.polygon[o-1].x,e.polygon[o].y=e.polygon[o-1].y;if(e.polygon[0].x+=e.velocityX,e.polygon[0].y+=e.velocityY,e.polygon[0].x<0||e.polygon[0].y<0||e.polygon[0].x>=this.screenWidth||e.polygon[0].y>=this.screenHeight||this.colliding({polygon:[e.polygon[0]]},{polygon:e.polygon.slice(3)}))if(e.shiftPolygons("color","#ffdddd",!0),this.setDetails("Lives",this.getDetails("Lives")-1),0===this.getDetails("Lives"))this.setTimeout(function(){ye.call(this,e)},500);else{var r=this;r.flashEnding(null,null,function(){r.unregisterSprite("snake")})}else{var s=this.getSprites();for(var l in s)"snake"!==l&&this.colliding(e,s[l])&&(e.polygon.push({x:t,y:i,width:1,height:1}),this.unregisterSprite(l),this.setDetails("Score",this.getDetails("Score")+100))}}};var ye=function(e){e.x=Math.floor(this.screenWidth/2),e.y=Math.floor(this.screenHeight/2),e.width=1,e.height=1,e.velocityX=1,e.velocityY=0,e.polygon=[{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight/2),width:1,height:1}],e.color="#ffdddd",thie.setDetails({Score:0,Lives:3}),this.setTimeout(function(){e.color="#eee"},500)};p.Snake.onkeydown=function(e){var t=this.getSprites("snake");switch(e.keyCode){case 38:case 87:t.velocityX=0,t.velocityY=-1;break;case 40:case 83:t.velocityX=0,t.velocityY=1;break;case 37:case 65:t.velocityX=-1,t.velocityY=0;break;case 39:case 68:t.velocityX=1,t.velocityY=0;break;case 32:this.isPaused()?this.unpause():this.pause()}},p.Snake.delay=180,p["Break Bricks"].init=function(){this.registerGlobal("score",0).registerGlobal("lives",0),this.registerSprite("paddle",{x:Math.floor(this.screenWidth/2),y:this.screenHeight-1,velocityX:0,velocityY:0,width:3,height:1});for(var e=0;3>e;e++)for(var t=0;t<this.screenWidth;t++)this.registerSprite("block_"+e+"_"+t,{x:t,y:e,velocityX:0,velocityY:0,width:1,height:1});this.registerSprite("ball",{x:Math.floor(this.screenWidth/2)+1,y:this.screenHeight-2,velocityX:0,velocityY:0,width:1,height:1,color:"#ddd"})},p["Break Bricks"].details={Lives:3,Score:0},p["Break Bricks"].onkeydown=function(e){var t=this.getSprites("paddle"),i=this.getSprites("ball");switch(e.keyCode){case 38:case 87:i.y===t.y-1&&i.x>=t.x&&i.x<t.x+t.width&&(i.velocityY=-1,2*Math.random()<1?i.velocityX++:i.velocityX--);break;case 37:case 65:t.x>0&&(i.y===t.y-1&&i.x>=t.x&&i.x<t.x+t.width&&!i.velocityX&&i.x--,t.x--);break;case 39:case 68:t.x+t.width<this.screenWidth&&(i.y===t.y-1&&i.x>=t.x&&i.x<t.x+t.width&&!i.velocityX&&i.x++,t.x++);break;case 32:this.isPaused()?this.unpause():this.pause()}},p["Break Bricks"].update=function(){var e=this.getSprites("ball"),t=this.getSprites(/block/),i=this.getSprites("paddle");if(e){e.y+e.velocityY>=0?e.y+=e.velocityY:(e.velocityY*=-1,e.y+=e.velocityY),e.velocityX>0?e.x+e.width<this.screenWidth?e.x+=e.velocityX:(e.velocityX*=-1,e.x+=e.velocityX):e.velocityX<0&&(e.x>0?e.x+=e.velocityX:(e.velocityX*=-1,e.x+=e.velocityX));for(var o in t)if(this.touching(e,t[o],!0)&&(e.velocityX*=-1,e.velocityY=Math.abs(e.velocityY),this.unregisterSprite(o),this.setDetails("Score",this.getDetails("Score")+100),0===Object.keys(this.getSprites(/block/)).length))return this.unregisterSprite("ball"),void this.flashEnding(3,200);if(this.collidingFromBelow(i,e)&&(e.velocityY=-Math.abs(e.velocityY)),e.y>this.screenHeight+2){e.velocityY=0,e.velocityX=0,e.y=this.screenHeight-2,e.x=i.x+1;var r=this.getDetails("Lives");this.setDetails("Lives",--r),0>=r&&(this.unregisterSprite("ball"),this.flashEnding(3,400))}}},p["Break Bricks"].delay=200,p["Whack-a-mole"].init=function(){this.registerGlobal("timeCount",0),this.registerGlobal("currentWait",20),this.registerGlobal("gameOver",!1)},p["Whack-a-mole"].details={Score:0},p["Whack-a-mole"].update=function(){if(this.getGlobals("gameOver")!==!0){var e=this.getGlobals("timeCount"),t=this.getGlobals("currentWait");return this.setGlobal("timeCount",e+1),e++,e%t===0&&de.call(this),1e3===e?pe.call(this):(e%100===0&&this.setGlobal("currentWait",t-1),Object.keys(this.getSprites()).length>10?ue.call(this):void 0)}};var de=function(){for(var e=(this.getSprites(/mole_/g),!0),t=0,i=0,o=0;e&&100>o;)t=Math.floor(Math.random()*this.screenWidth),i=Math.floor(Math.random()*this.screenHeight),this.getSprites("mole_"+t+"_"+i)||(e=!1);this.registerSprite("mole_"+t+"_"+i,{x:t,y:i})},pe=function(){this.setGlobal("gameOver",!0),this.registerSprite("gameOverIndicator",{x:0,y:0,width:1,height:1,color:"#ddffdd"})},ue=function(){this.setGlobal("gameOver",!0),this.registerSprite("gameOverIndicator",{x:0,y:0,width:1,height:1,color:"#ffdddd"})};p["Whack-a-mole"].onclick=function(e){var t=this.closestCell(e.target),i=this.cellCoordinates(t),o=i.x,r=i.y;this.getSprites("mole_"+o+"_"+r)&&(this.setDetails("Score",this.getDetails("Score")+100),this.unregisterSprite("mole_"+o+"_"+r))},p.Paint.init=function(){var t=this,i=document.createElement("input"),o=document.createElement("div"),r=t.getTable();i.type="color",t.registerGlobal("paintedCount",0),i.style.marginLeft=t.table.style.marginLeft||(e.getComputedStyle?e.getComputedStyle(t.table).getPropertyValue("margin-left"):""),i.onchange=function(e){t.setGlobal("storedColor",this.value)};this.getDetailsElement();r.style.marginBottom="0",o.appendChild(i),r.parentNode.insertBefore(o,r.nextSibling),t.registerGlobal("colorInput",i).registerGlobal("colorElm",o).registerGlobal("storedColor","#000000").registerGlobal("overTable",!1).registerGlobal("overColorElm",!1),le(o,"mouseleave",function(){t.setGlobal("overColorElm",!1),t.getGlobals("overTable")||t.pause()},!1),le(o,"mouseenter",function(){t.setGlobal("overColorElm",!0),t.unpause()},!1)},p.Paint.onpause=function(){this.getGlobals("colorInput").style.display="none"},p.Paint.onunpause=function(){this.getGlobals("colorInput").style.display="block"},p.Paint.onmouseleave=function(e){this.setGlobal("overTable",!1),y.getGlobals("overColorElm")||y.pause()},p.Paint.onmouseenter=function(e){this.setGlobal("overTable",!0),this.unpause()},p.Paint.onclick=function(e){fe.call(this,e)},p.Paint.onmousedrag=function(e){fe.call(this,e)};var fe=function(e){var t=(this.getGlobals("colorInput"),this.closestCell(e.target)),i=this.getGlobals("paintedCount");this.registerSprite("paintedCount"+i,{x:this.cellCoordinates(t).x,y:this.cellCoordinates(t).y,width:1,height:1,color:this.getGlobals("storedColor")}),this.setGlobal("paintedCount",i+1)};p.Maze.init=function(){this.registerSprite("wall1",{x:0,y:0,width:3,height:1}).registerSprite("wall2",{x:6,y:0,width:1,height:1}).registerSprite("wall3",{x:1,y:2,width:3,height:1}).registerSprite("wall4",{x:8,y:1,width:1,height:1}).registerSprite("wall5",{x:4,y:1,width:1,height:4}).registerSprite("wall6",{x:0,y:4,width:3,height:1}).registerSprite("wall7",{x:5,y:2,width:3,height:1}).registerSprite("wall8",{x:9,y:0,width:1,height:this.screenHeight}).registerSprite("wall9",{x:0,y:6,width:this.screenWidth,height:1}).registerSprite("wall10",{x:5,y:4,width:3,height:1}).registerSprite("goal",{x:8,y:0,width:1,height:1,color:"#ddffdd"}).registerSprite("player",{x:0,y:5,width:1,height:1,color:"#ddd"})},p.Maze.onkeydown=function(e){var t=this.getSprites("player"),l=this.getSprites("goal");switch(e.keyCode){case 38:case 87:i.call(this)&&t.y--;break;case 40:case 83:o.call(this)&&t.y++;break;case 37:
case 65:r.call(this)&&t.x--;break;case 39:case 68:s.call(this)&&t.x++;break;case 32:this.isPaused()?this.unpause():this.pause()}this.colliding(t,l)&&this.flashEnding()},p["Creepy Crawler"].init=function(){this.registerSprite("crawler",{velocityX:1,x:-1,y:-1,polygon:[{x:3,y:0,width:1,height:1},{x:2,y:0,width:1,height:1},{x:1,y:0,width:1,height:1},{x:0,y:0,width:1,height:1}]}),this.registerSprite("player",{x:Math.floor(this.screenWidth/2),y:Math.floor(this.screenHeight-1),width:1,height:1})},p["Creepy Crawler"].details={Score:0},p["Creepy Crawler"].update=function(){var e=this.getSprites("crawler"),t=e.polygon.length,i=this.getSprites(/playerBullet/),o=this.getSprites("player");if(e.polygon.length){for(;t-->1;)e.polygon[t].x=e.polygon[t-1].x,e.polygon[t].y=e.polygon[t-1].y;e.velocityX>0?e.polygon[0].x+e.velocityX<this.screenWidth?e.polygon[0].x+=e.velocityX:(e.polygon[0].y++,e.velocityX*=-1):e.polygon[0].x+e.velocityX>=0?e.polygon[0].x+=e.velocityX:(e.polygon[0].y++,e.velocityX*=-1);for(var r in i)this.colliding(i[r],e)&&(e.polygon.pop(),this.unregisterSprite(i[r].name));if(e.polygon.length||this.flashEnding(3,400),this.colliding(o,e)||e.y>this.screenHeight){var s=this;this.flashEnding(null,null,function(){s.unregisterSprite("crawler")})}}},p["Creepy Crawler"].delay=200,p["Creepy Crawler"].onkeydown=function(e){var t=(this.getSprites("crawler"),this.getSprites("player")),i=this.delay;switch(e.keyCode){case 38:case 87:var o=new l({x:t.x,y:t.y-1,velocityX:0,velocityY:-1},this);setTimeout(function(){o.moveY()},i);break;case 40:case 83:break;case 37:case 65:t.x>0&&t.x--;break;case 39:case 68:t.x+t.width<this.screenWidth&&t.x++;break;case 32:this.isPaused()?this.unpause():this.pause()}};var me=4,ve=0;p.Jumper.init=function(){this.registerSprite("player",{x:2,y:this.screenHeight-2,width:1,height:1,velocityX:0,velocityY:0}).registerSprite("ground",{x:0,y:this.screenHeight-1,width:this.screenWidth,height:1,velocityX:0,velocityY:0}).registerGlobal("awaitingReset",!1).registerGlobal("walls",{}).registerGlobal("timeCount",0),xe.call(this)},p.Jumper.details={Score:0},p.Jumper.update=function(){var e=this.getSprites(),t=this.getGlobals("timeCount"),i=this.getGlobals("awaitingReset"),o=this.getGlobals("walls"),r=this.getSprites("player");this.setGlobal("timeCount",t+1);for(var s in e)"player"!==s&&"ground"!==s&&(e[s].x+=e[s].velocityX,e[s].y+=e[s].velocityY,e[s].x<0&&(this.unregisterSprite(s),this.setDetails("Score",this.getDetails("Score")+100)));if(o[t]&&this.registerSprite("hurdle"+(e["hurdle"+t]?t+""+parseInt(100*Math.random()):t),{x:this.screenWidth-1,y:"undefined"==typeof o[t].y?this.screenHeight-1-o[t].height:o[t].y,width:1,height:o[t].height,velocityX:-1,velocityY:0}),be.call(this)?(r.velocityY<0&&me>ve?(r.y+=r.velocityY,ve++):(r.velocityY=Math.abs(r.velocityY),r.y+=r.velocityY),r.velocityY>0&&this.collidingFromAbove(r,e.ground)&&(r.velocityY=0,ve=0)):r.velocityY<0?r.velocityY*=-1:(r.velocityY=0,ve=0),!i)for(var s in e)"player"!==s&&"ground"!==s&&this.colliding(r,e[s])&&(this.setGlobal("awaitingReset",!0),this.flashEnding(null,null,xe));this.getGlobals("timeCount")+this.screenWidth===231&&this.flashEnding(3,400)};var xe=function(){var e=this.screenHeight-7,t={8:{height:3},18:{height:2},30:{height:3},40:{height:4},48:{height:3},60:{height:2},61:{y:0,height:e+2},70:{height:2},80:{height:4},90:{height:1},100:{height:2},101:{height:2},109:{height:3},112:{height:5},118:{height:2},121:{height:1},123:{height:1},127:{y:0,height:e+4},130:{height:2},144:{height:1},145:{y:1,height:e+1},146:{height:1},147:{y:1,height:e+2},148:{y:2,height:e+2},149:{y:3,height:e+1},160:{height:1},164:{height:2},170:{height:3},178:{height:2},178:{y:0,height:this.screenHeight-2},188:{height:2},194:{height:1},196:{height:2},198:{height:3},200:{height:5}},i=this.getSprites("player"),o=this.getSprites(/hurdle/);for(var r in o)this.unregisterSprite(r);this.flashEndingPosition=0,this.setGlobal("walls",t).setGlobal("timeCount",0).setGlobal("awaitingReset",!1),i.x=2,i.y=this.screenHeight-2,i.velocityY=0},be=function(){var e=this.getSprites(),t=e.player;if(this.collidingFromAbove(t,e.ground))return!0;for(var i in e)if("player"!==i&&"ground"!==i&&this.collidingFromAbove(t,e[i]))return!0;return!0},Se=function(){var e=this.getSprites(),t=e.player;for(var i in e)if("player"!==i&&this.collidingFromAbove(t,e[i]))return!0;return!1};p.Jumper.delay=100,p.Jumper.onkeydown=function(e){var t=this.getSprites("player");switch(e.keyCode){case 38:case 87:Se.call(this)&&(ve=0,t.velocityY=-1);break;case 37:case 65:t.x>0&&!t.velocityY&&t.x--;break;case 39:case 68:t.x<3&&!t.velocityY&&t.x++;break;case 32:this.isPaused()?this.unpause():this.pause()}},p.Sniper.init=function(){var e=parseInt(this.screenWidth/2,10),t=parseInt(this.screenHeight/2,10);this.registerGlobal("shootingSpot",0),this.registerGlobal("timeCount",0),this.registerSprite("enemy0",{x:2,y:2,width:1,height:1,color:"#ffdddd"}),this.registerSprite("enemy1",{x:Math.ceil(this.screenWidth/2),y:2,width:1,height:1,color:"#ddffdd"}),this.registerSprite("enemy2",{x:2*Math.floor(this.screenWidth/3),y:Math.ceil(this.screenHeight/2),width:1,height:1,color:"#ddddff"}),this.registerSprite("enemy3",{x:Math.ceil(this.screenWidth/3),y:Math.ceil(this.screenHeight/2),width:1,height:1,color:"#fdddbb"}),this.registerGlobal("scopeCoords",{x:1,y:1}),this.registerSprite("scopePart0",{x:0,y:0,width:7,height:1,color:"#eee"}),this.registerSprite("scopePart1",{x:0,y:1,width:3,height:1,color:"#eee"}),this.registerSprite("scopePart2",{x:4,y:1,width:3,height:1,color:"#eee"}),this.registerSprite("scopePart3",{x:0,y:2,width:2,height:1,color:"#eee"}),this.registerSprite("scopePart4",{x:5,y:2,width:2,height:1,color:"#eee"}),this.registerSprite("scopePart5",{x:0,y:3,width:1,height:1,color:"#eee"}),this.registerSprite("scopePart6",{x:6,y:3,width:1,height:1,color:"#eee"}),this.registerSprite("scopePart7",{x:0,y:4,width:2,height:1,color:"#eee"}),this.registerSprite("scopePart8",{x:5,y:4,width:2,height:1,color:"#eee"}),this.registerSprite("scopePart9",{x:0,y:5,width:3,height:1,color:"#eee"}),this.registerSprite("scopePart10",{x:4,y:5,width:3,height:1,color:"#eee"}),this.registerSprite("scopePart11",{x:0,y:6,width:7,height:1,color:"#eee"}),this.registerSprite("scopePartTop",{x:0,y:-1*t,width:7,height:t,color:"#eee"}),this.registerSprite("scopePartLeft",{x:-1*e,y:-1*t,width:e,height:2*this.screenHeight,color:"#eee"}),this.registerSprite("scopePartRight",{x:7,y:-1*t,width:e,height:2*this.screenHeight,color:"#eee"}),this.registerSprite("scopePartBottom",{x:0,y:6,width:7,height:t,color:"#eee"})},p.Sniper.details={Score:0},p.Sniper.update=function(){var e=this.getGlobals("scopeCoords"),t=this.getGlobals("shootingSpot"),i=this.getSprites(/enemy/),o=this.getGlobals("timeCount");if(o++,this.setGlobal("timeCount",o),t){if(1===t)for(var r in i)this.colliding({polygon:[{x:e.x+2,y:e.y+2,width:1,height:1}]},i[r])&&(this.setDetails("Score",this.getDetails("Score")+100),this.unregisterSprite(r));t--,this.setGlobal("shootingSpot",t),i=this.getSprites(/enemy/),Object.keys(i).length||this.flashEnding(3,200)}for(var r in i){var s=Math.floor(2.9*Math.random())-1,l=Math.round(Math.random()*o)%2,h=Math.floor(2.9*Math.random())-1,n=Math.round(Math.random()*o)%2,a=Math.random()*(o%10);i[r].x+s>=2&&i[r].x+s<this.screenWidth-3&&l&&1>a&&(i[r].x+=s),i[r].y+h>=2&&i[r].y+h<this.screenHeight-3&&n&&1>a&&(i[r].y+=h)}},p.Sniper.onpaint=function(){var e=this.getGlobals("scopeCoords"),t=this.getGlobals("shootingSpot");switch(t){case 3:this.fillRect(e.x+2,e.y,1,1),this.fillRect(e.x+1,e.y+1,3,1),this.fillRect(e.x,e.y+2,5,1),this.fillRect(e.x+1,e.y+3,3,1),this.fillRect(e.x+2,e.y+4,1,1);break;case 2:this.fillRect(e.x+2,e.y+1,1,1),this.fillRect(e.x+1,e.y+2,3,1),this.fillRect(e.x+2,e.y+3,1,1);break;case 1:this.fillRect(e.x+2,e.y+2,1,1)}},p.Sniper.delay=50,p.Sniper.onkeydown=function(e){var t=(this.getSprites(/scopePart/),this.getGlobals("scopeCoords")),i=this.getGlobals("shootingSpot");switch(e.keyCode){case 38:case 87:t.y>0&&we.call(this,0,-1);break;case 40:case 83:t.y+5<this.screenHeight&&we.call(this,0,1);break;case 37:case 65:t.x>0&&we.call(this,-1,0);break;case 39:case 68:t.x+5<this.screenWidth&&we.call(this,1,0);break;case 13:i||this.setGlobal("shootingSpot",4);break;case 32:this.isPaused()?this.unpause():this.pause()}};var we=function(e,t){var i=this.getSprites(/scopePart/),o=this.getGlobals("scopeCoords");o.x+=e,o.y+=t;for(var r in i)i[r].x+=e,i[r].y+=t},ke="#333",Ce="#000",We=ne.gray,Ge={left:0,right:0,top:0,bottom:0};p.Dungeon.init=function(){var e={x:1,y:3};this.registerGlobal("roomCoords",e),this.registerGlobal("startingColor","#ddd"),this.registerGlobal("roomTimeCount",0),this.registerGlobal("gameOver",!1),this.registerGlobal("hasKey",!1),this.registerGlobal("hasBlock",!1),this.registerGlobal("blockCoords",{blockCoords:{x:Math.floor(this.screenWidth/2),y:3,color:We},mapCoords:{x:3,y:0}}),this.registerGlobal("doorCoords",{left:{x:0,y:Math.floor(this.screenHeight/2)},top:{x:Math.floor(this.screenWidth/2),y:0},bottom:{x:Math.floor(this.screenWidth/2),y:this.screenHeight-1},right:{x:this.screenWidth-1,y:Math.floor(this.screenHeight/2)}}),this.registerSprite("player",{x:Math.floor(this.screenWidth/2),y:Math.ceil(this.screenHeight/2),width:1,height:1,color:"#ddd"}),this.registerSprite("topWall",{x:0,y:0,width:this.screenWidth,height:1}),this.registerSprite("bottomWall",{x:0,y:this.screenHeight-1,width:this.screenWidth,height:1}),this.registerSprite("leftWall",{x:0,y:0,width:1,height:this.screenHeight}),this.registerSprite("rightWall",{x:this.screenWidth-1,y:0,width:1,height:this.screenHeight}),h.call(this,e)},p.Dungeon.onkeydown=function(e){var t=this.getSprites("player"),i=this.getSprites("topDoor"),o=this.getSprites("rightDoor"),r=this.getSprites("bottomDoor"),s=this.getSprites("leftDoor"),l=this.getSprites("block"),h=this.getGlobals("blockCoords"),a=this.getSprites("key"),c=this.getGlobals("hasKey"),g=this.getSprites("keyhole"),y=this.getGlobals("hasBlock"),d=this.getGlobals("gameOver");switch(e.keyCode){case 38:case 87:if(g&&c&&this.collidingFromBelow(t,g)&&(this.unregisterSprite("keyhole"),t.y--,t.color=this.getGlobals("startingColor")),l&&this.collidingFromBelow(t,l))return y&&(t.y>1||i&&this.collidingFromBelow(t,i))&&!d?(t.y--,void(this.colliding(t,l)&&(l.y--,this.setGlobal("hasBlock",!1),this.colliding(l,i)&&(h.mapCoords.y--,h.blockCoords.y=this.screenHeight-3,this.unregisterSprite("block"))))):void(Ge.bottom||Ge.bottom++);(t.y>1||i&&this.collidingFromBelow(t,i))&&!d&&t.y--;break;case 40:case 83:if(l&&this.collidingFromAbove(t,l))return y&&(t.y<this.screenHeight-2||r&&this.collidingFromAbove(t,r))&&!d?(t.y++,void(this.colliding(t,l)&&(l.y++,this.setGlobal("hasBlock",!1),this.colliding(l,r)&&(h.mapCoords.y++,h.blockCoords.y=2,this.unregisterSprite("block"))))):void(Ge.top||Ge.top++);(t.y<this.screenHeight-2||r&&this.collidingFromAbove(t,r))&&t.y++;break;case 37:case 65:if(l&&this.collidingFromRight(t,l))return y&&(t.x>1||s&&this.collidingFromRight(t,s)||d)?(t.x--,void(this.colliding(t,l)&&(l.x--,this.setGlobal("hasBlock",!1),this.colliding(l,s)&&(h.mapCoords.x--,h.blockCoords.x=this.screenWidth-3,this.unregisterSprite("block"))))):void(Ge.right||Ge.right++);if((t.x>1||s&&this.collidingFromRight(t,s)||d)&&t.x--,a&&this.colliding(t,a)&&(t.color=a.color,this.unregisterSprite("key"),this.setGlobal("hasKey",!0),this.unregisterSprite("enemy"+(this.screenWidth-2))),d&&t.x<0)for(var p in this.getSprites())this.unregisterSprite(p);break;case 39:case 68:if(l&&this.collidingFromLeft(t,l))return y&&(t.x<this.screenWidth-2||o&&this.collidingFromLeft(t,o)||d)?(t.x++,void(this.colliding(t,l)&&(l.x++,this.setGlobal("hasBlock",!1),this.colliding(l,o)&&(h.mapCoords.x++,h.blockCoords.x=2,this.unregisterSprite("block"))))):void(Ge.left||Ge.left++);if((t.x<this.screenWidth-2||o&&this.collidingFromLeft(t,o)||d)&&t.x++,d&&t.x>this.screenWidth-1)for(var p in this.getSprites())this.unregisterSprite(p);break;case 32:this.isPaused()?this.unpause():this.pause()}if(-1!==[37,38,39,40,65,68,83,87].indexOf(e.keyCode)){var u=this.getSprites(/enemy/);for(var f in u)l&&this.colliding(l,u[f])&&(this.unregisterSprite(f),this.unregisterSprite("block"),this.setGlobal("blockCoords",{blockCoords:{x:-1,y:-1},mapCoords:{x:-1,y:-1}})),this.colliding(t,u[f])&&!this.flashEndingPosition&&this.flashEnding(3,150,n)}},p.Dungeon.onkeyup=function(e){switch(e.keyCode){case 38:case 87:Ge.bottom=0;break;case 40:case 83:Ge.top=0;break;case 37:case 65:Ge.right=0;break;case 39:case 68:Ge.left=0}},p.Dungeon.delay=50,p.Dungeon.update=function(e){var t=this.getSprites("topDoor"),i=this.getSprites("leftDoor"),o=this.getSprites("rightDoor"),r=this.getSprites("bottomDoor"),s=this.getGlobals("roomCoords"),l=this.getSprites("player"),a=this.getGlobals("roomTimeCount"),c=this.getSprites(/enemy/),g=this.getSprites("block"),y=this.getGlobals("hasKey"),d=!1;if(e||(a++,this.setGlobal("roomTimeCount",a)),t&&this.colliding(l,t)?(s.y--,s.y<0&&2===s.x&&(s.x=4,s.y=2),l.y=this.screenHeight-2,d=!0):i&&this.colliding(l,i)?(s.x--,l.x=this.screenWidth-2,d=!0):o&&this.colliding(l,o)?(s.x++,l.x=1,d=!0):r&&this.colliding(l,r)&&(s.y++,l.y=1,d=!0),d)return this.setGlobal("roomTimeCount",0),this.setGlobal("roomCoords",s),void h.call(this,s);if(1===s.x&&2===s.y){var p=this.screenHeight-3,u=Math.floor((a-1)/p),f=this.getSprites("enemy"+(u+1));f&&this.getSprites("enemy"+(u+1)).y++}else if(2===s.x&&3===s.y)if(y){if(a%10===5){var m=this.getSprites("enemy0");m.x<l.x?m.x++:m.x>l.x&&m.x--}else if(a%10===9){var m=this.getSprites("enemy0");m.y<l.y?m.y++:m.y>l.y&&m.y--}}else a%20===10?this.getSprites("enemy0").y++:a%20===19&&this.getSprites("enemy0").y--;else if(4===s.x&&3===s.y&&a%30===29){var m=this.getSprites("enemy0");m.x-1>0&&(m.x--,m.width++),m.x+m.width+1<this.screenWidth&&m.width++,m.y-1>0&&(m.y--,m.height++),m.y+m.height+1<this.screenHeight&&m.height++}else if(0===s.x&&0===s.y&&a%2===1){var v=Math.min(this.screenWidth-2,this.screenHeight-2),x=Math.floor(a/2)%v,m=this.getSprites("enemy0");m.x=this.screenWidth-1-v+x,m.y=this.screenHeight-1-v+x}else if(2===s.x&&1===s.y){var m=this.getSprites("enemy0"),b=this.getSprites("enemy1");10>a%40?(m.x=2,m.y=3,b.x=this.screenWidth-3,b.y=this.screenHeight-2):20>a%40?(m.x=Math.floor(this.screenWidth/2)-1,m.y=Math.floor(this.screenHeight/2)+1,b.x=Math.floor(this.screenWidth/2)-2,b.y=Math.floor(this.screenHeight/2)-1):30>a%40?(m.x=1,m.y=1,b.x=this.screenWidth-2,b.y=this.screenHeight-2):(m.x=Math.floor(this.screenWidth/3)-1,m.y=2*Math.floor(this.screenHeight/2)-1,b.x=this.screenWidth-2,b.y=Math.floor(this.screenHeight/2)-1),a%10>6&&(m.x=-1,m.y=-1,b.x=-1,b.y=-1)}else if(3===s.x&&1===s.y){var m=this.getSprites("enemy0"),b=this.getSprites("enemy1"),x=a%(2*(this.screenWidth-2));x<this.screenWidth-2?(m.x=this.screenWidth-1-(1+x),b.x=1+x):(x%=this.screenWidth-2,m.x=1+x,b.x=this.screenWidth-1-(1+x))}else if(1===s.x&&1===s.y){var m=this.getSprites("enemy0"),S=m.polygon[m.polygon.length-1],w=(this.screenWidth-2,this.screenWidth-2),k=this.screenHeight-2;if(m.polygon.length>=(this.screenWidth-2)*(this.screenHeight-2))return;S.y%2===1?1===S.x&&2===m.polygon[m.polygon.length-2].x?(w=1,k=S.y-1):(w=S.x-1,k=S.y):S.x===this.screenWidth-2&&m.polygon[m.polygon.length-2].x===this.screenWidth-3?(w=this.screenWidth-2,k=S.y-1):(w=S.x+1,k=S.y),m.polygon.push({x:w,y:k,width:1,height:1,color:Ce})}else if(4===s.x&&1===s.y){var C=this.getSprites("enemy0"),W=C.polygon.length,G=!1,M=(this.screenWidth-2)*(this.screenHeight-2),H=2*(M-W),P=Math.floor(H/2);for(a===H&&this.setGlobal("roomTimeCount",this.screenWidth-1-C.polygon.length),a%H>P&&(G=!0);W-->1;)C.polygon[W].x=C.polygon[W-1].x,C.polygon[W].y=C.polygon[W-1].y;C.velocityX>0?C.polygon[0].x+C.velocityX<this.screenWidth-1?C.polygon[0].x+=C.velocityX:(C.velocityX*=-1,G&&C.polygon[0].y>1?C.polygon[0].y--:C.polygon[0].y<this.screenHeight-2&&C.polygon[0].y++):C.polygon[0].x+C.velocityX>0?C.polygon[0].x+=C.velocityX:(C.velocityX*=-1,G&&C.polygon[0].y>1?C.polygon[0].y--:C.polygon[0].y<this.screenHeight-2&&C.polygon[0].y++)}var c=this.getSprites(/enemy/);for(var T in c)g&&this.colliding(g,c[T])&&(this.unregisterSprite(T),this.unregisterSprite("block"),this.setGlobal("blockCoords",{blockCoords:{x:-1,y:-1},mapCoords:{x:-1,y:-1}})),this.colliding(l,c[T])&&!this.flashEndingPosition&&this.flashEnding(3,150,n);if(y)for(var X in Ge)Ge[X]&&(Ge[X]++,Ge[X]>=60&&(Ge[X]=0,this.registerGlobal("hasBlock",!0)))},ne.prototype.addGamesList=function(t){var t=t||{},i=document.createElement("select"),o=document.createElement("option"),r=document.createTextNode("- Select - "),s=this;t&&Object.keys(t).length||(t=p),o.appendChild(r),o.value="0",i.appendChild(o);for(var l in t)o=document.createElement("option"),r=document.createTextNode(l),o.appendChild(r),o.value=l,i.appendChild(o);return i.onchange=function(e){s.pause(),"0"!==this.value&&(A=new ne(t[this.value]),this.parentNode.removeChild(this))},i.style.marginLeft=s.table.style.marginLeft||(e.getComputedStyle?e.getComputedStyle(s.table).getPropertyValue("margin-left"):""),s.table.parentNode.insertBefore(i,s.table.nextSibling),this},ne.closestTable=function(e){for(;e&&"TABLE"!==e.nodeName;)e=e.parentNode;return e},ne.clickToChoose=function(){document.getElementsByTagName("table");le(e,"click",Me,!1)};var Me=function(t){if(!se){var i=new ne({table:ne.closestTable(t.target)});i.addGamesList(),se=!0,he(e,"click",Me,!1)}};return ne}(window);